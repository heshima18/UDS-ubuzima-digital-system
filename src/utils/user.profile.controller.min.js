import{RemoveAuthDivs,addLoadingTab,addsCard,addshade,alertMessage,calcTime,deletechild,getPath,getdata,postschema,request,showAvaiAssurances,showAvaiEmps}from"./functions.controller.js";let q,w,e,r,t,y,u,i,o,p,a,s,d,f,g,h,j,k,l,z,x,c,v,b,n,m;export function addUprofile(s){e=addshade(),a=document.createElement("div"),e.appendChild(a),b="",q="",window.addEventListener("urlchange",function(){deletechild(e,e.parentElement)});for(const e of s.assurances)b+=`\n      <li class="ls-none flex p-5p bsbb">\n        <span class="fw-semibold mx-2">Name:</span> <span>${e.name}</span>\n      </li>\n      <li class="ls-none flex p-5p bsbb">\n        <span class="fw-semibold mx-2">Number:</span> <span>${e.number||"N/A"}</span>\n      </li>\n      <li class="ls-none flex p-5p bsbb">\n        <span class="fw-semibold mx-2">Status:</span> <span class="br-5p py-2p px-10p bsbb ${"eligible"==e.eligibility?"bc-tr-green green":"bc-tr-red red"}">${e.eligibility}</span>\n      </li>\n    `;for(const e of s.beneficiaries)q+=`\n      <li class="ls-none flex p-5p bsbb benef hover-6" data-id="${e.id}">\n        <span class="px-5p"><i class="bx bx-user"></i></span><span class="capitalize fw-semibold">${e.name}</span>\n      </li>\n    `;s.householder&&(q=`\n    <li class="ls-none flex p-5p bsbb benef hover-6" data-id="${s.householder.id}">\n      <span class="px-5p"><i class="bx bx-user"></i></span><span class="capitalize fw-semibold">${s.householder.name}</span>\n    </li>\n  `),s.dob=` ${new Date(s.dob).getDay()}/${new Date(s.dob).getMonth()}/${new Date(s.dob).getFullYear()}`,b||(b=' <li class="ls-none flex p-5p bsbb"><span class="btn btn-sm btn-label-danger">N/A</span></li>'),q||(q=' <li class="ls-none flex p-5p bsbb"><span class="btn btn-sm btn-label-secondary">N/A</span></li>'),a.className="w-80 h-80 p-20p bsbb ovh bc-white cntr zi-10000 br-10p card-5 b-mgc-resp",a.innerHTML=`\n    <div class="p-5p bsbb ovys w-100 h-100">\n      <div class="row h-100 w-100">\n        <div class="col-xl-4 col-lg-5 h-100 ovh col-md-5 ovh">\n            <!-- About User -->\n            <div class=" mb-4 ovh h-100">\n                <div class="card-body h-100 ovys scroll-2">\n                    <small class="text-muted text-uppercase">About</small>\n                    <ul class="list-unstyled mb-4 mt-3">\n                        <li class="d-flex align-items-center mb-3">\n                          <i class="bx bx-user"></i><span class="fw-semibold dgray mx-2">Full Name:</span> <span class="capitalize">${s.Full_name}</span>\n                        </li>\n                        <li class="d-flex align-items-center mb-3">\n                          <i class="fas fa-venus-mars"></i><span class="fw-semibold dgray mx-2">Gender:</span> <span class="capitalize">${s.gender}</span>\n                        </li>\n                        <li class="d-flex align-items-center mb-3">\n                          <i class="bx bx-calendar"></i><span class="fw-semibold dgray mx-2">DOB:</span> <span>${s.dob}</span>\n                        </li>\n                        <li class="d-flex align-items-center mb-3">\n                          <i class="far fa-id-card"></i><span class="fw-semibold dgray mx-2">NID:</span> <span>${s.nid}</span>\n                        </li>\n                        <li class="align-items-center mb-3">\n                          <i class="fas fa-hand-holding-medical"></i><span class="fw-semibold dgray mx-2">Insurance(s):</span> <span class="block">\n                            <ul>\n                              ${b}\n                            </ul>\n                              </span>\n                        </li>\n                        <li class="align-items-center mb-3">\n                        <i class="fas fa-users"></i><span class="fw-semibold dgray mx-2">${"householder"==s.role?"Beneficiaries:":"Parent"}</span> <span class="block">\n                            <ul class="px-3p">\n                              ${q}\n                            </ul>\n                            </span>\n                        </li>\n                        <small class="text-muted text-uppercase"><i class="fas fa-map-marker-alt pr-10p"></i> <span class="iblock mt--5p">Location</span></small>\n                        <li class="d-flex align-items-center mb-3 mt-5p">\n                            <i class="bx bx-check"></i><span class="fw-semibold dgray mx-2">Province:</span> <span>${s.province}</span>\n                        </li><li class="d-flex align-items-center mb-3">\n                          <i class="bx bx-check"></i><span class="fw-semibold dgray mx-2">District:</span> <span>${s.district}</span>\n                        </li><li class="d-flex align-items-center mb-3">\n                          <i class="bx bx-check"></i><span class="fw-semibold dgray mx-2">Sector:</span> <span>${s.sector}</span>\n                        </li><li class="d-flex align-items-center mb-3">\n                          <i class="bx bx-check"></i><span class="fw-semibold dgray mx-2">Cell:</span> <span>${s.cell}</span>\n                        </li><li class="d-flex align-items-center mb-3">\n                          <i class="bx bx-check"></i><span class="fw-semibold dgray mx-2">Status:</span> <span>${s.status}</span>\n                        </li><li class="d-flex align-items-center mb-3">\n                          <i class="fas fa-user-tag"></i><span class="fw-semibold dgray mx-2">Title:</span> <span>patient</span>\n                        </li>\n                    </ul>\n                    <small class="text-muted text-uppercase">Contacts</small>\n                    <ul class="list-unstyled mb-4 mt-3">\n                        <li class="d-flex align-items-center mb-3"><i class="bx bx-phone"></i><span class="fw-semibold dgray mx-2">Phone number:</span> <span>${s.phone}</span>\n                        </li>\n                        <li class="d-flex align-items-center mb-3"><i class="bx bx-envelope"></i><span class="fw-semibold dgray mx-2">Email:</span>\n                            <span>${s.email}</span>\n                        </li>\n                    </ul>\n                </div>\n            </div>\n            <!--/ About User -->\n        </div>\n        <div class="col-xl-8 col-lg-7 h-100 ovh col-md-7">\n            <!-- Activity Timeline -->\n            <div class="br-5p h-100 ovh">\n                <div class="py-20p h-70p">\n                    <h5 class="card-action-title mb-0 left dgray"><span class="center-2"><span class="center"><i class="fas fa-file-medical pr-10p"></i></span><span class="capitalize">medical history</span></span></h5>\n                </div>\n                <div class="p-10p p-r w-100 h-90 ovys scroll-2" id="mh-body">\n                    \n                </div>\n            </div>\n        </div>\n      </div>\n    </div>`;let n=Array.from(a.querySelectorAll("li.benef"));for(const e of n)e.addEventListener("click",async function(e){e.preventDefault(),this.classList.add("selected");let s=this.getAttribute("data-id");if(addLoadingTab(a),r=await request(`patient/${s}`,postschema),!r.success)return alertMessage(r.message);deletechild(a.parentNode,a.parentNode.parentNode);let n=new URL(window.location.href);n.pathname=`/${getPath()[0]}/search-patient/${s}`,window.history.pushState({},"",n.toString()),"receptionist"==getPath()[0]?uprofileStf(r):addUprofile(r.message)});let t=a.querySelector("div#mh-body");addLoadingTab(t);let l=document.createElement("div");l.classList="p-a zi-100 cntr mt-50p",l.innerHTML=`<button class="btn ${"hc_provider"!=getPath()[0]?"btn-secondary":"btn-primary"}" ${"hc_provider"!=getPath()[0]?'disabled="true"':""}>Load medical history</button>`;let i=l.querySelector("button");return i.onclick=async function(a){if(a.preventDefault(),"hc_provider"!=getPath()[0])alertMessage("you are not authorized to perform this action");else{if(postschema.body=JSON.stringify({token:getdata("token")}),i.innerText,i.setAttribute("disabled",!0),r=await request(`get-user-medical-history/${s.id}`,postschema),!r.success)return i.innerText,i.removeAttribute("disabled"),alertMessage(r.message);RemoveAuthDivs(),t.innerHTML=null;let a=document.createElement("ul");a.className="timeline w-100",t.appendChild(a);for(const e of r.message){let s=document.createElement("li");s.className="timeline-item hover-2",s.setAttribute("data-id",e.session_id),s.innerHTML=` <span class="timeline-point timeline-point-info"></span>\n        <div class="pb-20p">\n            <div class="timeline-header mb-1">\n                <h6 class="mb-0">#${e.session_id}</h6>\n                <small class="text-muted">${calcTime(e.dateclosed)}</small>\n            </div>\n            <p class="mb-0">session at ${e.hp_info.name}</p>\n        </div>`,a.appendChild(s)}let n=Array.from(a.querySelectorAll("li"));n.forEach(s=>{s.addEventListener("click",a=>{a.preventDefault();let n=new URL(window.location.href);n.pathname=`/${getPath()[0]}/view-session/${s.getAttribute("data-id")}`,window.history.pushState({},"",n.toString()),deletechild(e,e.parentNode);const t=new Event("urlchange",{bubbles:!0});window.dispatchEvent(t)})})}},t.appendChild(l),a}export async function uprofileStf(e,s){d=addUprofile(e.message),x=document.createElement("div"),d.appendChild(x),x.className="p-f b-0 p-20p bsbb zi-1000 center w-100 l-0",x.innerHTML='<button type="button" class="btn rounded-pill btn-primary capitalize">notify consultant</button>',x=x.querySelector("button");let a=await showAvaiAssurances(e.message.assurances);l=Array.from(a.querySelectorAll("li.assurance"));for(const s of l)s.addEventListener("click",async function(s){s.preventDefault(),this.classList.add("selected");let n=this.getAttribute("data-id");"null"==n&&(n=null),e.message.assurances=n,deletechild(a,a.parentNode),addsCard("Assurance Selected",!0)});x.addEventListener("click",async a=>{a.preventDefault(),p=await showAvaiEmps(s);let n=Array.from(p.querySelectorAll(".emp")),t=Array.from(p.querySelectorAll(".dep"));for(const s of n)s.addEventListener("click",async function(s){s.preventDefault(),this.classList.add("selected");let a=this.getAttribute("data-id");j=JSON.parse(postschema.body),Object.assign(j,{title:"incoming patient",receiver:a,type:"p_message",content:`there is an incoming patient called ${e.message.Full_name}`,extra:{name:e.message.Full_name,patient:e.message.id,nid:e.message.nid,assurance:e.message.assurances},controller:{looping:!1,recipients:[]}}),postschema.body=JSON.stringify(j),deletechild(p,p.parentNode),x.setAttribute("disabled",!0),x.innerText="notifying the receiver...",e=await request("send-message",postschema),x.removeAttribute("disabled"),x.innerText="consultant notified !",x.classList.replace("btn-primary","btn-success"),deletechild(d.parentNode,d.parentNode.parentNode),addsCard("consultant notified !",!0)});for(const s of t)s.addEventListener("click",async function(a){let n=Array.from(s.parentNode.parentElement.querySelectorAll(".emp"));n=n.map(function(e){return e.getAttribute("data-id")}),j=JSON.parse(postschema.body),Object.assign(j,{title:"incoming patient",receiver:n,type:"p_message",content:`there is an incoming patient called ${e.message.Full_name}`,extra:{name:e.message.Full_name,patient:e.message.id,nid:e.message.nid,assurance:e.message.assurances},controller:{looping:!0,recipients:n}}),postschema.body=JSON.stringify(j),deletechild(p,p.parentNode),x.setAttribute("disabled",!0),x.innerText="notifying the receiver...",e=await request("send-message",postschema),x.removeAttribute("disabled"),x.innerText="consultant notified !",x.classList.replace("btn-primary","btn-success"),deletechild(d.parentNode,d.parentNode.parentNode),addsCard("consultant notified !",!0)})})}