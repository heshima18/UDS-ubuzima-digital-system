import query from"../controllers/query.controller";import errorMessage from"../controllers/response.message.controller";export const authorizeUserAssurance=async(s,e,r)=>{try{const{assurance:o,patient:a}=s.body;if(console.log("body for assurance check"),!a)return e.status(403).send({message:errorMessage.assu_user_error_message,success:!1});let t=await query("select assurances from patients where id = ?",[a]);if(!t)return e.status(500).send({message:errorMessage.is_error,success:!1});if(0==t.length)return r();t=JSON.parse(t[0].assurances);for(const s of t)if(s.id==o)return"eligible"==s.status?r():(console.log("not eligible for using this assurance"),e.status(401).send({message:errorMessage.assu_user_error_message,success:!1}));return null!=o?(console.log("this assurance is not available"),e.status(401).send({message:errorMessage.assu_user_error_message,success:!1})):r()}catch(s){console.log(s),e.status(500).send({message:errorMessage.is_error,success:!1})}};