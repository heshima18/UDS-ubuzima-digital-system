import{getCustomHps}from"../controllers/hospital.controller";import query from"../controllers/query.controller";import addToken from"../controllers/token.signer.controller";import authenticateToken from"../controllers/token.verifier.controller";import server from"./holder.socket";export const io=require("socket.io")(server,{cors:{origin:"*",methods:["GET","POST"]}});io.on("connection",e=>{const o=e.handshake.query.id;query("update users set online = ? where id = ?",[!0,o]),e.on("disconnect",()=>{query("update users set online = ?, last_seen = current_timestamp() where id = ?",[!1,o])}),e.on("getpsforselection",async o=>{e.emit("selecthp",await getCustomHps(o))}),e.on("hpchoosen",o=>{let{hp:t,token:r}=o;if(r=authenticateToken(r),r.success)try{r=r.token,r.hospital=t.id,r.hp_name=t.name,r=addToken(r),e.emit("changetoken",r)}catch(e){}})});