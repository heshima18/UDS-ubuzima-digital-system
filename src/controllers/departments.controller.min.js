import query from"./query.controller";import errorMessage from"./response.message.controller";import id from"./randomInt.generator.controller";import{checkArrayAvai}from"./credentials.verifier.controller";export const addDepartment=async(e,s)=>{let{name:r}=e.body,t=await query("insert into departments(id,name)values(?,?)",[id(),r]);t?s.send({success:!0,message:errorMessage.dc_message}):s.status(500).send({success:!1,message:errorMessage.is_error})};export const getDepartments=async(e,s)=>{let r=await query("select name,id from  departments",[]);r?s.send({success:!0,message:r}):s.status(500).send({success:!1,message:errorMessage.is_error})};export const addDepartmentToHp=async(e,s)=>{try{let{department:r,hospital:t}=e.body,a=await checkArrayAvai("hospitals","departments",r,"id",t);if(!a)return s.status(500).send({success:!1,message:errorMessage.is_error});if(a.length)return s.send({success:!1,message:errorMessage.err_entr_avai});let o=await query("UPDATE hospitals SET departments = JSON_ARRAY_APPEND(departments, '$', ?) where hospitals.id = ?",[r,t]);if(!o)return s.status(500).send({success:!1,message:errorMessage.is_error});if(!o.affectedRows)return s.status(404).send({success:!1,message:errorMessage._err_hc_404});s.send({success:!0,message:errorMessage.dc_message})}catch(e){console.log(e),s.status(500).send({success:!1,message:errorMessage.is_error})}};export const removeDepartmentFromHospital=async(e,s)=>{try{let{hospital:r,department:t}=e.body,a=await checkArrayAvai("hospitals","departments",t,"id",r);if(!a)return s.status(500).send({success:!1,message:errorMessage.is_error});if(!a.length)return s.send({success:!1,message:errorMessage.err_entr_not_avai});let o=await query("UPDATE hospitals SET departments = JSON_REMOVE(departments,JSON_UNQUOTE(JSON_SEARCH(departments, 'one',?))) where hospitals.id = ?",[t,r]);if(!o)return s.status(500).send({success:!1,message:errorMessage.is_error});s.send({success:!0,message:errorMessage.entr_removed})}catch(e){s.status(500).send({success:!1,message:errorMessage.is_error}),console.log(e)}};