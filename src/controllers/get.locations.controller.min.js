import query from"./query.controller";import errorMessage from"./response.message.controller";const getMap=async(n,s)=>{try{let n=await query("SELECT\n      CONCAT(\n          '[',\n          GROUP_CONCAT(\n              CONCAT(\n                  '{\"id\": ', province_id, ', \"name\": \"', province_name, '\", \"districts\": ',\n                  COALESCE(districts, '[]'),\n                  '}'\n              )\n              ORDER BY province_id\n              SEPARATOR ','\n          ),\n          ']'\n      ) AS provinces\n  FROM (\n      SELECT\n          p.id AS province_id,\n          p.name AS province_name,\n          CONCAT(\n              '[',\n              GROUP_CONCAT(\n                  CONCAT(\n                      '{\"id\": ', district_id, ', \"name\": \"', district_name, '\", \"sectors\": ',\n                      COALESCE(sectors, '[]'),\n                      '}'\n                  )\n                  ORDER BY district_id\n                  SEPARATOR ','\n              ),\n              ']'\n          ) AS districts\n      FROM\n          provinces p\n          LEFT JOIN districts d ON p.id = d.province\n          LEFT JOIN (\n              SELECT\n                  d.id AS district_id,\n                  d.name AS district_name,\n                  CONCAT(\n                      '[',\n                      GROUP_CONCAT(\n                          CONCAT(\n                              '{\"id\": ', sector_id, ', \"name\": \"', sector_name, '\", \"cells\": ',\n                              COALESCE(cells, '[]'),\n                              '}'\n                          )\n                          ORDER BY sector_id\n                          SEPARATOR ','\n                      ),\n                      ']'\n                  ) AS sectors\n              FROM\n                  districts d\n                  LEFT JOIN sectors s ON d.id = s.district\n                  LEFT JOIN (\n                      SELECT\n                          s.id AS sector_id,\n                          s.name AS sector_name,\n                          CONCAT(\n                              '[',\n                              GROUP_CONCAT(\n                                  CONCAT(\n                                      '{\"id\": ', c.id, ', \"name\": \"', c.name, '\"}'\n                                  )\n                                  ORDER BY c.id\n                                  SEPARATOR ','\n                              ),\n                              ']'\n                          ) AS cells\n                      FROM\n                          sectors s\n                          LEFT JOIN cells c ON s.id = c.sector\n                      GROUP BY\n                          s.id, s.name\n                  ) AS sector_data ON s.id = sector_data.sector_id\n              GROUP BY\n                  d.id, d.name\n          ) AS district_data ON d.id = district_data.district_id\n      GROUP BY\n          p.id, p.name\n  ) AS province_data\n  GROUP BY\n      province_id, province_name;\n  ",[]);if(!n)return s.status(500).send({success:!1,message:errorMessage.is_error});for(const s of n)n[n.indexOf(s)].provinces=JSON.parse(s.provinces);s.send({success:!0,message:n})}catch(n){console.log(n),s.status(500).send({success:!1,message:errorMessage.is_error})}};export default getMap;