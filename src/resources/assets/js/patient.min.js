function addAppointmentDiv(){let e=addshade(),t=document.createElement("div");e.appendChild(t),t.className="br-10p cntr card p-10p bsbb w-70 h-70 b-mgc-resp",t.innerHTML='<div class="w-100 h-100 p-5p bp-0-resp">\n        <div class="head w-100 px-5p py-10p bsbb">\n            <span class="capitalize bold-2 fs-20p">book an appointment</span>\n        </div>\n        <div class="body p-5p bsbb w-100 h-91 ovh">\n            <div class="w-100 h-100 ovys scroll-2">\n                <form action="" method="post" name="add-appointment">\n                    <div class="w-100 h-100 ovys w-100 h-100">\n                        <div class="col-md-12 p-10p bsbb mb-5p p-r">\n                            <label for="hospital" class="form-label">hospital</label>\n                            <input type="text" class="form-control bevalue" id="hospital" placeholder="Hospital name" name="hospital">\n                            <small class="hidden w-100 red pl-3p verdana"></small>\n                        </div>\n                        <div class="col-md-12 p-10p bsbb mb-5p p-r">\n                            <label for="department" class="form-label">department</label>\n                            <input type="text" class="form-control bevalue" id="department" placeholder="Department name" name="department">\n                            <small class="hidden w-100 red pl-3p verdana"></small>\n                        </div>\n                        <div class="col-md-12 p-10p bsbb mb-5p p-r">\n                            <label for="subject" class="form-label">reason for appointment</label>\n                            <input type="text" class="form-control" id="subject" placeholder="main cause" name="content">\n                            <small class="hidden w-100 red pl-3p verdana"></small>\n                        </div>\n                        <div class="col-md-12 p-10p bsbb mb-5p p-r">\n                            <label for="message" class="form-label">Message</label>\n                            <textarea class="form-control" id="message" rows="3" name="message" placeholder="description of the appointment"></textarea>\n                            <small class="hidden w-100 red pl-3p verdana"></small>\n                        </div>\n                        <div class="col-md-12 p-10p bsbb mb-5p p-r">\n                           <button type="submit" class="btn btn-primary">proceed</button>\n                        </div>\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>';let a,n=t.querySelector("form"),o=Array.from(n.querySelectorAll(".form-control")),i=o.find(function(e){return"hospital"==e.id}),l=o.find(function(e){return"department"==e.id});i.addEventListener("focus",function(e){h=i.getAttribute("data-id"),showRecs(this,hps.message,this.id),i.addEventListener("blur",()=>{setTimeout(function(){h!=i.getAttribute("data-id")&&(l.value="",l.removeAttribute("data-id"))},200)})}),l.addEventListener("focus",function(e){let t=i.getAttribute("data-id");if(!t)return checkEmpty(i),i.focus(),0;let s=hps.message.find(function(e){return e.id==t});if(!s)return 0;l.addEventListener("blur",function(e){setTimeout(function(){a=s.employees.filter(function(e){return e.department=l.getAttribute("data-id")})},200)});let n=s.departments;showRecs(this,n,this.id)}),n.addEventListener("submit",async function(t){if(t.preventDefault(),this.classList.contains("loading"))return 0;if(v=1,s={},o.forEach(e=>{d=checkEmpty(e),d||(v=0),Object.assign(s,{[e.name]:e.classList.contains("bevalue")?e.getAttribute("data-id"):e.value})}),v){a=a.map(function(e){return e.id}),Object.assign(s,{token:getdata("token"),type:"__APPNTMNT_MSSG_",extra:{content:s.message},controller:{looping:!0,recipients:a}}),s.title="incoming appointment request",this.classList.add("loading"),n.querySelector("button").innerHTML='<span class="spinner-border" role="status" aria-hidden="true"></span>',postschema.body=JSON.stringify(s);let t=await request("send-message",postschema);n.querySelector("button").innerHTML="proceed",t.success&&(alertMessage("appointment message sent successfully wait for an approval message"),deletechild(e,e.parentNode))}})}async function viewAppointmentDiv(e){let t=addshade(),a=document.createElement("div");t.appendChild(a),a.className="br-10p cntr card p-10p bsbb w-450p h-a b-mgc-resp",a.innerHTML=`<div class="w-100 h-100 p-5p bp-0-resp">\n                        <div class="head w-100 px-5p py-10p bsbb">\n                            <span class="capitalize bold-2 fs-20p">Appointment # <span class="consolas">${e}</span></span>\n                        </div>\n                        <div class="p-5p bsbb w-100 h-91 ovh p-r">\n                            <div class="w-100 h-100 ovys scroll-2 body">\n                                <div class="w-100 h-a my-10p">\n                                    <span class="capitalize pr-5p">with</span><span class="black capitalize" data-holder="true" data-hold="hc_provider"></span>\n                                    <span class="capitalize px-5p">at</span><span class="black capitalize" data-holder="true" data-hold="hospital"></span>\n                                </div>\n                                <div class="w-100 h-a my-10p">\n                                    <span class="dgray capitalize block">reason for appointment: </span>\n                                    <span class="black capitalize block" data-holder="true" data-hold="subject"> </span>\n                                </div>\n                                <div class="w-100 h-a my-10p">\n                                    <span class="dgray capitalize block">description: </span>\n                                    <span class="black capitalize block" data-holder="true" data-hold="message"> </span>\n                                </div>\n                                <div class="w-100 h-a my-10p" id="time-holder">\n                                    <span class="dgray capitalize block">estimated time: </span>\n                                    <span class="black capitalize block" data-holder="true" data-hold="time">\n                                    </span>\n                                </div>\n                                <div class="w-100 h-a my-10p">\n                                    <span class="dgray capitalize block">date booked: </span>\n                                    <span class="black capitalize block" data-holder="true" data-hold="date_booked">       \n                                </span>\n                            </div>\n                            </div>\n                        </div>\n                    </div>`;let s=a.querySelector("div.body");if(addLoadingTab(s),postschema.body=JSON.stringify({token:getdata("token")}),e=await request(`appointment/${e}`,postschema),!e.success)return alertMessage(e.message);e=e.message,removeLoadingTab(s);let n=Array.from(a.querySelectorAll('[data-holder="true"]'));if(n.forEach(t=>{let a=t.getAttribute("data-hold");-1!=a.indexOf("time")||-1!=a.indexOf("date")?t.innerText=fT(e[a]):t.innerText=e[a]}),e.extra){let t=s.querySelector("div#time-holder"),a=document.createElement("div");a.className="w-100 h-a my-10p",a.innerHTML=`<span class="dgray capitalize block">${Object.keys(e.extra)[0]} </span>\n                            <span class="black capitalize block" data-holder="true" data-hold="${Object.keys(e.extra)[0]}">${e.extra[Object.keys(e.extra)[0]]}</span>`,s.insertBefore(a,t)}}import{alertMessage,getdata,getschema,postschema,request,deletechild,checkEmpty,showRecs,getchips,getPath,addsCard,cpgcntn,geturl,sessiondata,addChip,showAvaiAssurances,adcm,addshade,addLoadingTab,removeLoadingTab,showAvaiEmps,fT,calcTime,aDePh}from"../../../utils/functions.controller.js";import{expirateMssg,pushNotifs,userinfo}from"./nav.js";let q,w,e,r,t,y,u,i,o,p,a,s,d,f,g,h,j,k,l,x,c,v,b,n,m,z;(async function(){async function e(e,t){try{if(x=e.id,"home"==x);else if("medical-history"==x){let t=document.querySelector('ul[data-role="sessions-holder"]');t.innerHTML=null;const s=new Map;u.forEach(e=>{const t=new Date(e.dateadded),a=t.getFullYear();t.setMonth(t.getMonth());const n=new Intl.DateTimeFormat("en-US",{month:"long"}).format(t);s.has(a)||s.set(a,new Map),s.get(a).has(n)||s.get(a).set(n,[]),s.get(a).get(n).push(e)});const n=Array.from(s,([e,t])=>({year:e,months:Array.from(t,([e,t])=>({month:e,sessions:t}))}));for(const e of n)for(const a of e.months){let s=document.createElement("li");s.className="ovh",t.appendChild(s),s.innerHTML=`<div class="w-100 h-70p p-5p my-10p ovh">\n                                            <div class="w-100 h-100 bc-tr-white">\n                                                <div class="header w-100 h-60p card br-5p bc-white p-r block hover-2">\n                                                    <div class="w-100 h-100 flex jc-sb p-5p bsbb">\n                                                        <span class="dgray center capitalize px-10p fs-16p">${a.month} / ${e.year}</span>\n                                                        <span class="px-25p center spanner hover-2" data-role="span">\n                                                            <span class="right-arrow tr-0-3"></span>\n                                                        </span>\n                                                    </div>\n                                                </div>\n                                                <div class="w-100 h-a p-10p bsbb session-holder"></div>\n                                            </div>\n                                        </div>`;const n=s.querySelector("div.session-holder");for(const e of a.sessions){let t=document.createElement("div");n.appendChild(t),t.className="w-270p h-a bfull-resp p-5p bsbb iblock",t.innerHTML=`<div class="card">\n                                                    <div class="p-15p capitalize dgray flex jc-sb">\n                                                        <div class="flex">\n                                                            <span class="black fs-20p px-5p">#</span><span class="center">${e.session_id}</span>\n                                                        </div>\n                                                        <div class="center-2">\n                                                        <span class="btn ${"open"==e.status?"btn-label-success":"btn-label-secondary"} btn-xs mx-5p">${e.status}</span>\n                                                        <span class="btn btn-primary btn-sm view-session-butt" data-id="${e.session_id}">View</span>\n                                                        </div>\n                                                    </div>\n                                                    <div class="p-15p">\n                                                        <h5 class="card-title capitalize">${e.hp_info.name}</h5>\n                                                        <p class="px-5p">\n                                                        <span class="capitalize fs-15p">session at ${e.hp_info.name} on ${fT(e.dateadded)}</span>\n                                                        </p>\n                                                        <span class="capitalize fs-14p block">${e.hp_info.location}<span>\n                                                    </div>\n                                                </div>`}}let o=Array.from(e.querySelectorAll('[data-role="span"]'));for(const e of o)e.parentNode.parentNode.addEventListener("click",t=>{t.preventDefault(),e.children[0].classList.toggle("down-arrow"),e.children[0].classList.toggle("left-arrow");let a=e.parentNode.parentNode.parentNode.parentNode;a.classList.toggle("h-a")});let i=Array.from(e.querySelectorAll("span.view-session-butt"));async function a(e){q=addshade(),d=document.createElement("div"),d.className="br-10p cntr card p-20p bsbb w-80 h-85 b-mgc-resp ovh",q.appendChild(d),b=document.getElementById("view-session"),b=b.cloneNode(!0),b.classList.remove("hidden"),d.appendChild(b),addLoadingTab(d),postschema.body=JSON.stringify({token:getdata("token")});let t=await request(`session/${e}`,postschema);if(!t.success)return alertMessage(t.message);removeLoadingTab(d),t=t.message,Object.assign(t.payment_info,{total_amount:Number(t.payment_info.a_amount)+Number(t.payment_info.p_amount)});const a=Array.from(d.querySelectorAll('span[name="info-hol"]')),s=Array.from(d.querySelectorAll('ul[name="looping-info"]'));for(const e of s){let a=e.getAttribute("data-hold"),s=t[a];if(s.length){for(const t of s){Object.assign(t,{total_amount:(Number(t.price)*Number(t.quantity)).toFixed(2)});let s=e.cloneNode(!0),n=Array.from(s.querySelectorAll('[name="looping-info-hol"]'));if("medicines"==a&&("served"==t.status?(s.classList.add("bc-tr-green"),n.find(function(e){return"name"==e.getAttribute("data-hold")}).classList.replace("dgray","green")):s.classList.add("bc-gray"),t.servedOut)){let e=document.createElement("span");e.innerText="( served out )",e.className="fs-10p p-a t-0 mt-50p l-0 ml-25p",s.appendChild(e)}for(const e of n)-1!=e.getAttribute("data-hold").indexOf("quantity")||-1!=e.getAttribute("data-hold").indexOf("amount")?e.innerText=adcm(t[e.getAttribute("data-hold")]):-1!=e.getAttribute("data-hold").indexOf("result")?("positive"==t[e.getAttribute("data-hold")]||"positif"==t[e.getAttribute("data-hold")]?e.classList.add("green"):e.classList.add("red"),e.innerText=t[e.getAttribute("data-hold")]):"decisions"!=a||e.getAttribute("data-hold")?e.innerText=t[e.getAttribute("data-hold")]:e.innerText=t;e.parentNode.appendChild(s)}e.parentNode.removeChild(e)}else aDePh(e.parentElement),e.parentNode.removeChild(e)}for(const e of a){let a=e.getAttribute("data-hold");if(-1!=a.indexOf("."))a=a.split("."),-1!=a[1].indexOf("amount")?e.innerText=adcm(t[a[0]][a[1]]):-1!=a[0].indexOf("p_info")&&-1!=a[1].indexOf("name")?(e.innerText=t[a[0]][a[1]],e.classList.add("hover-6","data-buttons"),e.setAttribute("data-role","show-profile"),e.setAttribute("data-id",t[a[0]].id)):e.innerText=t[a[0]][a[1]];else{if(-1!=e.getAttribute("data-hold").indexOf("status")&&"open"==t[e.getAttribute("data-hold")]&&e.classList.replace("btn-label-secondary","btn-label-success"),!a in t||!t[a]){e.innerText="no entries available";continue}e.innerText=t[a]}}}i.forEach(e=>{e.onclick=function(t){t.preventDefault();let s=e.getAttribute("data-id");a(s)}})}else if("payments-history"==x){let t=document.querySelector('ul[data-role="payments-holder"]');t.innerHTML=null;const a=new Map;u.forEach(e=>{const t=new Date(e.dateadded),s=t.getFullYear();t.setMonth(t.getMonth());const n=new Intl.DateTimeFormat("en-US",{month:"long"}).format(t);a.has(s)||a.set(s,new Map),a.get(s).has(n)||a.get(s).set(n,[]),a.get(s).get(n).push(e)});const s=Array.from(a,([e,t])=>({year:e,months:Array.from(t,([e,t])=>({month:e,sessions:t}))}));for(const e of s)for(const a of e.months){let s=document.createElement("li");s.className="ovh",t.appendChild(s),s.innerHTML=`<div class="w-100 h-70p p-5p my-10p ovh">\n                                            <div class="w-100 h-100 bc-tr-white">\n                                                <div class="header w-100 h-60p card br-5p bc-white p-r block hover-2">\n                                                    <div class="w-100 h-100 flex jc-sb p-5p bsbb">\n                                                        <span class="dgray center capitalize px-10p fs-16p">${a.month} / ${e.year}</span>\n                                                        <span class="px-25p center spanner hover-2" data-role="span">\n                                                            <span class="right-arrow tr-0-3"></span>\n                                                        </span>\n                                                    </div>\n                                                </div>\n                                                <div class="w-100 h-a p-10p bsbb session-holder"></div>\n                                            </div>\n                                        </div>`;const n=s.querySelector("div.session-holder");for(const e of a.sessions)if("open"!=e.status){let t=document.createElement("div");n.appendChild(t),t.className="w-250p h-a bfull-resp p-5p bsbb iblock",t.innerHTML=`<div class="card">\n                                                        <div class="p-15p capitalize dgray flex jc-sb">\n                                                            <div class="flex">\n                                                                <span class="black fs-20p px-5p">#</span><span class="center">${e.payment_info.id}</span>\n                                                            </div>\n                                                            ${"paid"==e.payment_info.status?'<span class="btn btn-label-success btn-sm">paid</span>':'<span class="btn btn-label-primary btn-sm">pay</span>'}\n                                                            \n                                                        </div>\n                                                        <div class="p-15p">\n                                                            <h5 class="card-title capitalize">${e.hp_info.name}</h5>\n                                                            <p class="px-5p">\n                                                            <span class="capitalize fs-14p">payment of session at ${e.hp_info.name} on ${new Intl.DateTimeFormat("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e.dateadded))}</span>\n                                                            </p>\n                                                            <p class="flex">\n                                                                <span class="capitalize fs-15p block bold-2">${adcm(e.payment_info.p_amount)}</span>\n                                                                <span class="dgray fs-15p px-5p">RWF</span>\n                                                            </p>\n                                                        </div>\n                                                    </div>`}if(!n.innerHTML){let e=document.createElement("div");e.className="ovh center-2",n.appendChild(e),e.innerHTML='<span class="capitalize dgray flex fs-16p bold-2">no entries available</span>'}}let n=Array.from(e.querySelectorAll('[data-role="span"]'));for(const e of n)e.parentNode.parentNode.addEventListener("click",t=>{t.preventDefault(),e.children[0].classList.toggle("down-arrow"),e.children[0].classList.toggle("left-arrow");let a=e.parentNode.parentNode.parentNode.parentNode;a.classList.toggle("h-a")})}else if("appointments"==x){let t=document.querySelector('ul[data-role="appointments-holder"]');t.innerHTML=null;const a=new Map;f.forEach(e=>{const t=new Date(e.date_booked),s=t.getFullYear();t.setMonth(t.getMonth());const n=new Intl.DateTimeFormat("en-US",{month:"long"}).format(t);a.has(s)||a.set(s,new Map),a.get(s).has(n)||a.get(s).set(n,[]),a.get(s).get(n).push(e)});const s=Array.from(a,([e,t])=>({year:e,months:Array.from(t,([e,t])=>({month:e,appointments:t}))}));for(const e of s)for(const a of e.months){let s=document.createElement("li");s.className="ovh",t.appendChild(s),s.innerHTML=`<div class="w-100 h-70p p-5p my-10p ovh">\n                                            <div class="w-100 h-100 bc-tr-white">\n                                                <div class="header w-100 h-60p card br-5p bc-white p-r block hover-2">\n                                                    <div class="w-100 h-100 flex jc-sb p-5p bsbb">\n                                                        <span class="dgray center capitalize px-10p fs-16p">${a.month} / ${e.year}</span>\n                                                        <span class="px-25p center spanner hover-2" data-role="span">\n                                                            <span class="right-arrow tr-0-3"></span>\n                                                        </span>\n                                                    </div>\n                                                </div>\n                                                <div class="w-100 h-a p-10p bsbb appointment-holder"></div>\n                                            </div>\n                                        </div>`;const n=s.querySelector("div.appointment-holder");for(const e of a.appointments)if("open"!=e.status){let t=document.createElement("div");n.appendChild(t),t.className="w-250p h-a bfull-resp p-5p bsbb iblock",t.innerHTML=`<div class="card">\n                                                        <div class="p-15p capitalize dgray flex jc-sb">\n                                                            <div class="flex">\n                                                                <span class="black fs-20p px-5p hover-2">#</span><span class="center hover-2">${e.id}</span>\n                                                            </div>\n                                                            <span class="btn  btn-sm ${"declined"==e.status?"btn-label-danger":"approved"==e.status?"btn-label-success":(e.status,"btn-label-secondary")}" data-role="button">${e.status}</span>  \n                                                        </div>\n                                                        <div class="p-15p hover-2" data-role="button" data-id="${e.id}" id ="view-appointment">\n                                                            <h5 class="card-title capitalize">${e.subject}</h5>\n                                                            <p class="px-5p">\n                                                            <span class="capitalize fs-14p">appointment at ${e.hospital}</span>\n                                                            </p>\n                                                            <p class="px-5p">\n                                                            <span class="capitalize fs-14p">on ${fT(e.time)}</span>\n                                                            </p>\n                                                            <p class="flex">\n                                                                <span class="dgray fs-15p px-5p">${calcTime(e.date_booked)}</span>\n                                                            </p>\n                                                        </div>\n                                                    </div>`}if(!n.innerHTML){let e=document.createElement("div");e.className="ovh center-2",n.appendChild(e),e.innerHTML='<span class="capitalize dgray flex fs-16p bold-2">no entries available</span>'}}let n=Array.from(e.querySelectorAll('[data-role="span"]'));for(const e of n)e.parentNode.parentNode.addEventListener("click",t=>{t.preventDefault(),e.children[0].classList.toggle("down-arrow"),e.children[0].classList.toggle("left-arrow");let a=e.parentNode.parentNode.parentNode.parentNode;a.classList.toggle("h-a")});let o=Array.from(e.querySelectorAll('[data-role="button"]'));o.map(e=>{e.onclick=function(t){if(e.classList.contains("loading"))return 0;if(t.preventDefault(),"appointment"==e.id)addAppointmentDiv();else if("view-appointment"==e.id){let t=e.getAttribute("data-id");viewAppointmentDiv(t)}}})}else if("my-account"==x){n=e.querySelector("span.name"),z=getdata("userinfo"),n.textContent=z.Full_name,i=e.querySelector("span.n-img"),i.textContent=z.Full_name.substring(0,1);let t=Array.from(e.querySelectorAll("span.icon-edit-icon"));for(const e of t)e.addEventListener("click",()=>{l=e.getAttribute("data-target"),shedtpopup(l,r)})}}catch(e){console.log(e)}}const s=await request("gethospitals",postschema);z=userinfo;let o=getdata("token");if(o||(window.location.href="../../login/"),!z.success)return localStorage.removeItem("token"),alertMessage(z.message);if(z.success){z=z.message;try{const e=io(geturl(),{query:{id:z.id}});e.on("connect",()=>{console.log("Connected to the server")}),e.on("message",e=>{pushNotifs(e),addsCard(e.title,!0)}),e.on("expiratemssg",e=>{expirateMssg(e)}),e.on("selecthp",t=>{var a=document.createElement("div");document.body.appendChild(a);for(const e of t)a.innerHTML+=`<div id="${e.id}" class="verdana hover p-5p">${e.name}</div>`;let s=a.querySelectorAll("div");s.forEach(t=>{t.addEventListener("click",a=>{a.preventDefault(),e.emit("hpchoosen",{hp:t.id,token:localStorage.getItem("token")})})})}),e.on("changetoken",e=>{window.alert("token changed"),localStorage.setItem("token",e),window.location.href=window.location.href}),e.emit("messageToId",{recipientId:z.id,message:"wassup"}),"string"!=typeof z.hospital&&"object"==typeof z.hospital&&z.hospital.length>0&&e.emit("getpsforselection",z.hospital)}catch(e){console.log(e)}}postschema.body=JSON.stringify({token:o});let m=await request("get-user-medical-history",postschema),h=await request("my-appointments",postschema);if(!m.success||!s.success||!h.success)return alertMessage(m.message);const u=m.message,f=h.message;a=getPath(1),c=Array.from(document.querySelectorAll("span.cpcards")),p=Array.from(document.querySelectorAll("div.pagecontentsection")),a?p.forEach(s=>{if(a==s.id)return t=p.indexOf(s),c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),c[t].classList.add("active","bb-1-s-theme","bc-tr-theme","theme"),cpgcntn(t,p),e(s),0}):(window.history.pushState("","","./home"),cpgcntn(0,p)),window.onpopstate=function(){a=getPath(1),a?p.forEach(e=>{if(a==e.id)return t=p.indexOf(e),c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),c[t].classList.add("active","bb-1-s-theme","bc-tr-theme","theme"),cpgcntn(t,p),0}):(window.history.pushState("","","./home"),cpgcntn(0,p))},c.forEach(t=>{t.addEventListener("click",()=>{c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),t.classList.add("active","bb-1-s-theme","bc-tr-theme","theme");let a=new URL(window.location.href);a.pathname=`/patient/${t.getAttribute("data-item-type")}`,window.history.pushState({},"",a.toString()),cpgcntn(c.indexOf(t),p),e(p.find(function(e){return e.id==t.getAttribute("data-item-type")}))})})})();