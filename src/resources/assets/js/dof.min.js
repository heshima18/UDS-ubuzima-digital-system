import{alertMessage,getdata,getschema,postschema,request,initializeCleave,sessiondata,addLoadingTab,removeLoadingTab,checkEmpty,showRecs,getchips,getPath,addsCard,cpgcntn,geturl,adcm,addshade,deletechild}from"../../../utils/functions.controller.js";import{expirateMssg,pushNotifs,userinfo}from"./nav.js";let q,w,e,t,y,u,i,o,p,a,s,d,f,g,h,j,k,l,x,c,v,b,n,m,z;(async function(){async function s(t,a){try{if(x=t.id,"my-account"==x){n=t.querySelector("span.name"),z=getdata("userinfo"),n.textContent=z.Full_name,i=t.querySelector("span.n-img"),i.textContent=z.Full_name.substring(0,1);let e=Array.from(t.querySelectorAll("span.icon-edit-icon"));for(const t of e)t.addEventListener("click",()=>{l=t.getAttribute("data-target"),shedtpopup(l,r)})}else if("medications-inventory"==x){let s=$(".datatables-medications"),n=document.querySelector("table");if(!n.classList.contains("loaded")){e=s.DataTable({dom:'<"row mx-2"<"col-md-2"<"me-3"l>><"col-md-10"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-3 mb-md-0"fB>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search..."},columns:[{data:"",title:""},{data:"name",title:"Name"},{data:"quantity",title:"Quantity available"},{data:"unit",title:"Measuring unit"},{data:"price",title:"medication's price (RWF)"},{title:"Action",data:"id"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(){return""}},{targets:1,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class="capitalize">${e}</span>`}},{targets:2,searchable:!1,orderable:1,render:function(e,t,a,s){return`<span class="">${adcm(e)}</span>`}},{targets:3,searchable:!1,orderable:1,render:function(e,t,a,s){return`<span class="capitalize">${e}</span>`}},{targets:-1,searchable:!1,orderable:!1,render:function(e,t,a,s){return`<div class="d-inline-block text-nowrap">\n                                        <button class="btn btn-sm btn-icon data-buttns" data-type="medicines" data-role="edit" data-id="${e}" data-bs-target = "#edit-medicine"><i class="bx bx-edit"></i></button>\n                                        <button class="btn btn-sm btn-icon data-buttns" data-type="medicines" data-role="delete" data-id="${e}"><i class="bx bx-trash"></i></button>\n                                    </div>`}}],order:[[1,"asc"]],data:a.medicines,buttons:[{extend:"collection",className:"btn btn-outline-secondary dropdown-toggle mx-3",text:'<i class="bx bx-export me-1"></i>Export',buttons:[{extend:"print",text:'<i class="bx bx-printer me-2" ></i>Print',className:"dropdown-item"},{extend:"excel",text:'<i class="bx bxs-file-export me-2"></i>Excel',className:"dropdown-item"},{extend:"pdf",text:'<i class="bx bxs-file-pdf me-2"></i>Pdf',className:"dropdown-item"}]},{text:'<i class="bx bx-plus me-0 me-sm-1"></i><span class="d-none d-sm-inline-block">Add New</span>',className:"add-new btn btn-primary",attr:{id:"add-medic","data-bs-target":"#add-medicine"}}],initComplete:function(){this.api().columns(3).every(function(){var e=this,t=$('<select class="form-select text-capitalize"><option value=""> Select Measuring Unit </option></select>').appendTo(".employee-position").on("change",function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(e,a){t.append('<option value="'+e+'">'+e+"</option>")})})}});let r=t.querySelector("#add-medic"),i=Array.from(t.querySelectorAll("button.data-buttns"));r.onclick=function(){let s=this.getAttribute("data-bs-target"),n=t.querySelector(`div${s}`);n=n.cloneNode(!0),d=addshade(),d.appendChild(n);let r=n.querySelector("form"),i=Array.from(r.querySelectorAll("input"));i[0].onfocus=(e=>{e.preventDefault(),showRecs(i[0],m.message,i[0].id)}),r.onsubmit=(async t=>{t.preventDefault(),l=1;for(const e of i)v=checkEmpty(e),v||(l=0);if(l){let t=r.querySelector('button[type="submit"]');t.innerHTML='<span class="spinner-border" role="status" aria-hidden="true"></span>',t.setAttribute("disabled",!0);let s={};for(const e of i)Object.assign(s,{[e.name]:getchips(e.parentNode.querySelector("div.chipsholder"),["id","name","price","quantity","unit"])});Object.assign(s,{assurance:this.assurance,token:getdata("token"),assurance:a.id}),postschema.body=JSON.stringify(s);let n=await request("add-inventory",postschema);s.medicines.forEach(t=>{e.row.add(t).draw()}),n.success&&deletechild(d,d.parentElement),alertMessage(n.message),t.removeAttribute("disabled"),t.innerHTML="proceed"}})},i.forEach(s=>{s.onclick=async function(s){s.preventDefault();let n=this.getAttribute("data-role"),r=this.getAttribute("data-id"),i=this.getAttribute("data-type");if("delete"==n){postschema.body=JSON.stringify({token:getdata("token"),type:i,inventory:a.id,needle:r});var o=e.row(s.target.closest("tr"));o.remove().draw();let t=await request("rIFromInv",postschema);t.success,alertMessage(t.message)}else if("edit"==n){let e=a.medicines.find(function(e){return e.id==r}),s=this.getAttribute("data-bs-target"),n=t.querySelector(`div${s}`);n=n.cloneNode(!0),d=addshade(),d.appendChild(n);let i=n.querySelector("form#edit-medicine-form"),o=i.querySelector('input[name="medicine"]'),l=i.querySelector('input[name="quantity"]');o.value=e.name,o.setAttribute("readonly",!0),o.setAttribute("disabled",!0),o.setAttribute("data-id",e.id),l.value=e.quantity,i.addEventListener("submit",async e=>{if(e.preventDefault(),v=checkEmpty(l),v){let e=i.querySelector('button[type="submit"]');e.innerText="Editing entry",e.setAttribute("disabled",!0);let t={};Object.assign(t,{needle:o.getAttribute("data-id"),upinfo:{quantity:l.value},type:"medicines",inventory:a.id}),Object.assign(t,{token:getdata("token")}),postschema.body=JSON.stringify(t);let s=await request("eInvEnt",postschema);s.success&&deletechild(d,d.parentNode),alertMessage(s.message),e.removeAttribute("disabled"),e.innerText="proceed"}})}}}),n.classList.add("loaded")}}else if("tests-inventory"==x){let s=$(".datatables-tests"),n=t.querySelector("table");n.classList.contains("loaded")||(e=s.DataTable({dom:'<"row mx-2"<"col-md-2"<"me-3"l>><"col-md-10"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-3 mb-md-0"fB>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search..."},columns:[{data:"",title:""},{data:"name",title:"Name"},{data:"price",title:"Test's price (RWF)"},{title:"Action",data:"id"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(){return""}},{targets:1,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class="capitalize">${e}</span>`}},{targets:2,searchable:!1,orderable:1,render:function(e,t,a,s){return`<span class="">${adcm(e)}</span>`}},{targets:-1,searchable:!1,orderable:!1,render:function(e,t,a,s){return`<div class="d-inline-block text-nowrap">\n                                        <button class="btn btn-sm btn-icon data-buttns" data-type="tests" data-role="edit" data-id="${e}" data-bs-target = "#edit-test"><i class="bx bx-edit"></i></button>\n                                        <button class="btn btn-sm btn-icon data-buttns" data-type="tests" data-role="delete" data-id="${e}"><i class="bx bx-trash"></i></button>\n                                    </div>`}}],order:[[1,"asc"]],data:a.tests,buttons:[{extend:"collection",className:"btn btn-outline-secondary dropdown-toggle mx-3",text:'<i class="bx bx-export me-1"></i>Export',buttons:[{extend:"print",text:'<i class="bx bx-printer me-2" ></i>Print',className:"dropdown-item"},{extend:"excel",text:'<i class="bx bxs-file-export me-2"></i>Excel',className:"dropdown-item"},{extend:"pdf",text:'<i class="bx bxs-file-pdf me-2"></i>Pdf',className:"dropdown-item"}]},{text:'<i class="bx bx-plus me-0 me-sm-1"></i><span class="d-none d-sm-inline-block">Add New</span>',className:"add-new btn btn-primary",attr:{id:"add-test","data-bs-target":"#add-test"}}],initComplete:function(){this.api().columns(3).every(function(){var e=this,t=$('<select class="form-select text-capitalize"><option value=""> Select Measuring Unit </option></select>').appendTo(".employee-position").on("change",function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(e,a){t.append('<option value="'+e+'">'+e+"</option>")})})}}));let r=t.querySelector("#add-test"),i=Array.from(t.querySelectorAll("button.data-buttns"));r.onclick=function(){let t=this.getAttribute("data-bs-target"),s=document.querySelector(`div${t}`);s=s.cloneNode(!0),d=addshade(),d.appendChild(s);let n=s.querySelector("form"),r=Array.from(n.querySelectorAll("input"));r[0].onfocus=(e=>{e.preventDefault(),showRecs(r[0],f.message,r[0].id)}),n.onsubmit=(async t=>{t.preventDefault(),l=1;for(const e of r)v=checkEmpty(e),v||(l=0);if(l){let t=n.querySelector('button[type="submit"]');t.innerHTML='<span class="spinner-border" role="status" aria-hidden="true"></span>',t.setAttribute("disabled",!0);let s={};for(const e of r)Object.assign(s,{[e.name]:getchips(e.parentNode.querySelector("div.chipsholder"),["id","name","price"])});Object.assign(s,{assurance:this.assurance,token:getdata("token"),assurance:a.id}),postschema.body=JSON.stringify(s);let i=await request("add-inventory-tests",postschema);i.success&&(s.tests.forEach(t=>{e.row.add(t).draw()}),deletechild(d,d.parentElement)),alertMessage(i.message),t.removeAttribute("disabled"),t.innerHTML="proceed"}})},i.forEach(s=>{s.onclick=async function(s){s.preventDefault();let n=this.getAttribute("data-role"),r=this.getAttribute("data-id"),i=this.getAttribute("data-type");if("delete"==n){postschema.body=JSON.stringify({token:getdata("token"),type:i,inventory:a.id,needle:r});var o=e.row(s.target.closest("tr"));o.remove().draw();let t=await request("rIFromInv",postschema);t.success,alertMessage(t.message)}else if("edit"==n){let e=a.tests.find(function(e){return e.id==r}),s=this.getAttribute("data-bs-target"),n=t.querySelector(`div${s}`);n=n.cloneNode(!0),d=addshade(),d.appendChild(n);let o=n.querySelector("form#edit-test-form"),l=o.querySelector('input[name="test"]'),c=o.querySelector('input[name="price"]');l.value=e.name,l.setAttribute("readonly",!0),l.setAttribute("disabled",!0),l.setAttribute("data-id",e.id),c.value=e.price,o.addEventListener("submit",async e=>{if(e.preventDefault(),v=checkEmpty(c),v){let e=o.querySelector('button[type="submit"]');e.innerText="Editing entry",e.setAttribute("disabled",!0);let t={};Object.assign(t,{needle:l.getAttribute("data-id"),upinfo:{price:c.value},type:i,inventory:a.id}),Object.assign(t,{token:getdata("token")}),postschema.body=JSON.stringify(t);let s=await request("eInvEnt",postschema);s.success&&deletechild(d,d.parentNode),alertMessage(s.message),e.removeAttribute("disabled"),e.innerText="proceed"}})}}}),n.classList.add("loaded"),s.find("tbody").on("click",".delete-employee",function(){confirm("Are you sure you want to delete this employee?")&&e.row($(this).parents("tr")).remove().draw()})}else if("operations-inventory"==x){let s=$(".datatables-operations"),n=t.querySelector("table");n.classList.contains("loaded")||(e=s.DataTable({dom:'<"row mx-2"<"col-md-2"<"me-3"l>><"col-md-10"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-3 mb-md-0"fB>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search..."},columns:[{data:"",title:""},{data:"name",title:"Name"},{data:"price",title:"Operation's price (RWF)"},{title:"Action",data:"id"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(){return""}},{targets:1,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class="capitalize">${e}</span>`}},{targets:2,searchable:!1,orderable:1,render:function(e,t,a,s){return`<span class="">${adcm(e)}</span>`}},{targets:-1,searchable:!1,orderable:!1,render:function(e,t,a,s){return`<div class="d-inline-block text-nowrap">\n                                        <button class="btn btn-sm btn-icon data-buttns" data-type="operations" data-role="edit" data-id="${e}" data-bs-target = "#edit-operation"><i class="bx bx-edit"></i></button>\n                                        <button class="btn btn-sm btn-icon data-buttns" data-type="operations" data-role="delete" data-id="${e}"><i class="bx bx-trash"></i></button>\n                                    </div>`}}],order:[[1,"asc"]],data:a.operations,buttons:[{extend:"collection",className:"btn btn-outline-secondary dropdown-toggle mx-3",text:'<i class="bx bx-export me-1"></i>Export',buttons:[{extend:"print",text:'<i class="bx bx-printer me-2" ></i>Print',className:"dropdown-item"},{extend:"excel",text:'<i class="bx bxs-file-export me-2"></i>Excel',className:"dropdown-item"},{extend:"pdf",text:'<i class="bx bxs-file-pdf me-2"></i>Pdf',className:"dropdown-item"}]},{text:'<i class="bx bx-plus me-0 me-sm-1"></i><span class="d-none d-sm-inline-block">Add New</span>',className:"add-new btn btn-primary",attr:{id:"add-operation","data-bs-target":"#add-operation-modal"}}],initComplete:function(){this.api().columns(3).every(function(){var e=this,t=$('<select class="form-select text-capitalize"><option value=""> Select Measuring Unit </option></select>').appendTo(".employee-position").on("change",function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(e,a){t.append('<option value="'+e+'">'+e+"</option>")})})}}));let r=t.querySelector("#add-operation"),i=Array.from(t.querySelectorAll("button.data-buttns"));r.onclick=function(){let a=this.getAttribute("data-bs-target"),s=t.querySelector(`div${a}`);s=s.cloneNode(!0),d=addshade(),d.appendChild(s);let n=s.querySelector("form"),r=Array.from(n.querySelectorAll("input"));r[0].onfocus=(e=>{e.preventDefault(),showRecs(r[0],g.message,r[0].id)}),n.onsubmit=(async t=>{t.preventDefault(),l=1;for(const e of r)v=checkEmpty(e),v||(l=0);if(l){let t=n.querySelector('button[type="submit"]');t.innerHTML='<span class="spinner-border" role="status" aria-hidden="true"></span>',t.setAttribute("disabled",!0);let a={};for(const e of r)Object.assign(a,{[e.name]:getchips(e.parentNode.querySelector("div.chipsholder"),["id","name","price"])});Object.assign(a,{token:getdata("token")}),postschema.body=JSON.stringify(a);let s=await request("add-inventory-operations",postschema);s.success&&(a.operations.forEach(t=>{e.row.add(t).draw()}),deletechild(d,d.parentElement)),alertMessage(s.message),t.removeAttribute("disabled"),t.innerHTML="proceed"}})},i.forEach(s=>{s.onclick=async function(s){s.preventDefault();let n=this.getAttribute("data-role"),r=this.getAttribute("data-id"),i=this.getAttribute("data-type");if("delete"==n){postschema.body=JSON.stringify({token:getdata("token"),type:i,inventory:a.id,needle:r});var o=e.row(s.target.closest("tr"));o.remove().draw();let t=await request("rIFromInv",postschema);t.success,alertMessage(t.message)}else if("edit"==n){let e=a.operations.find(function(e){return e.id==r}),s=this.getAttribute("data-bs-target"),n=t.querySelector(`div${s}`);n=n.cloneNode(!0),d=addshade(),d.appendChild(n);let o=n.querySelector("form#edit-operation-form"),l=o.querySelector('input[name="operation"]'),c=o.querySelector('input[name="price"]');l.value=e.name,l.setAttribute("readonly",!0),l.setAttribute("disabled",!0),l.setAttribute("data-id",e.id),c.value=e.price,o.addEventListener("submit",async e=>{if(e.preventDefault(),v=checkEmpty(c),v){let e=o.querySelector('button[type="submit"]');e.innerText="Editing entry",e.setAttribute("disabled",!0);let t={};Object.assign(t,{needle:l.getAttribute("data-id"),upinfo:{price:c.value},type:i,inventory:a.id}),Object.assign(t,{token:getdata("token")}),postschema.body=JSON.stringify(t);let s=await request("eInvEnt",postschema);s.success&&deletechild(d,d.parentNode),alertMessage(s.message),e.removeAttribute("disabled"),e.innerText="proceed"}})}}}),n.classList.add("loaded"),s.find("tbody").on("click",".delete-employee",function(){confirm("Are you sure you want to delete this employee?")&&e.row($(this).parents("tr")).remove().draw()})}else if("services-inventory"==x){let s=$(".datatables-services"),n=t.querySelector("table");n.classList.contains("loaded")||(e=s.DataTable({dom:'<"row mx-2"<"col-md-2"<"me-3"l>><"col-md-10"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-3 mb-md-0"fB>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search..."},columns:[{data:"",title:""},{data:"name",title:"Name"},{data:"price",title:"service's price (RWF)"},{data:"unit",title:"measurement unit"},{title:"Action",data:"id"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(){return""}},{targets:1,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class="capitalize">${e}</span>`}},{targets:2,searchable:!1,orderable:1,render:function(e,t,a,s){return`<span class="">${adcm(e)}</span>`}},{targets:-1,searchable:!1,orderable:!1,render:function(e,t,a,s){return`<div class="d-inline-block text-nowrap">\n                                        <button class="btn btn-sm btn-icon data-buttns" data-type="services" data-role="edit" data-id="${e}" data-bs-target = "#edit-service"><i class="bx bx-edit"></i></button>\n                                        <button class="btn btn-sm btn-icon data-buttns" data-type="services" data-role="delete" data-id="${e}"><i class="bx bx-trash"></i></button>\n                                    </div>`}}],order:[[1,"asc"]],data:a.services,buttons:[{extend:"collection",className:"btn btn-outline-secondary dropdown-toggle mx-3",text:'<i class="bx bx-export me-1"></i>Export',buttons:[{extend:"print",text:'<i class="bx bx-printer me-2" ></i>Print',className:"dropdown-item"},{extend:"excel",text:'<i class="bx bxs-file-export me-2"></i>Excel',className:"dropdown-item"},{extend:"pdf",text:'<i class="bx bxs-file-pdf me-2"></i>Pdf',className:"dropdown-item"}]},{text:'<i class="bx bx-plus me-0 me-sm-1"></i><span class="d-none d-sm-inline-block">Add New</span>',className:"add-new btn btn-primary",attr:{id:"add-service","data-bs-target":"#add-service-modal"}}],initComplete:function(){this.api().columns(3).every(function(){var e=this,t=$('<select class="form-select text-capitalize"><option value=""> Select Measuring Unit </option></select>').appendTo(".employee-position").on("change",function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(e,a){t.append('<option value="'+e+'">'+e+"</option>")})})}}));let r=Array.from(t.querySelectorAll("button.data-buttns"));r.forEach(s=>{s.onclick=async function(s){s.preventDefault();let n=this.getAttribute("data-role"),r=this.getAttribute("data-id"),i=this.getAttribute("data-type");if("delete"==n){postschema.body=JSON.stringify({token:getdata("token"),type:i,inventory:a.id,needle:r});var o=e.row(s.target.closest("tr"));o.remove().draw();let t=await request("rIFromInv",postschema);t.success,alertMessage(t.message)}else if("edit"==n){let e=a.services.find(function(e){return e.id==r}),s=this.getAttribute("data-bs-target"),n=t.querySelector(`div${s}`);n=n.cloneNode(!0),d=addshade(),d.appendChild(n);let o=n.querySelector("form#edit-service-form"),l=o.querySelector('input[name="service"]'),c=o.querySelector('input[name="price"]');l.value=e.name,l.setAttribute("readonly",!0),l.setAttribute("disabled",!0),l.setAttribute("data-id",e.id),c.value=e.price,o.addEventListener("submit",async e=>{if(e.preventDefault(),v=checkEmpty(c),v){let e=o.querySelector('button[type="submit"]');e.innerText="Editing entry",e.setAttribute("disabled",!0);let t={};Object.assign(t,{needle:l.getAttribute("data-id"),upinfo:{price:c.value},type:i,inventory:a.id}),Object.assign(t,{token:getdata("token")}),postschema.body=JSON.stringify(t);let s=await request("eInvEnt",postschema);s.success&&deletechild(d,d.parentNode),alertMessage(s.message),e.removeAttribute("disabled"),e.innerText="proceed"}})}}});let i=t.querySelector("#add-service");i.onclick=function(){let s=this.getAttribute("data-bs-target"),n=t.querySelector(`div${s}`);n=n.cloneNode(!0),d=addshade(),d.appendChild(n);let r=n.querySelector("form"),i=Array.from(r.querySelectorAll("input"));i[0].onfocus=(e=>{e.preventDefault(),showRecs(i[0],b.message,i[0].id)}),r.onsubmit=(async t=>{t.preventDefault(),l=1;for(const e of i)v=checkEmpty(e),v||(l=0);if(l){let t=r.querySelector('button[type="submit"]');t.innerHTML='<span class="spinner-border" role="status" aria-hidden="true"></span>',t.setAttribute("disabled",!0);let s={};for(const e of i)Object.assign(s,{[e.name]:getchips(e.parentNode.querySelector("div.chipsholder"),["id","name","price"])});Object.assign(s,{assurance:this.assurance,token:getdata("token"),assurance:a.id}),postschema.body=JSON.stringify(s);let n=await request("add-inventory-services",postschema);n.success&&(s.services.forEach(t=>{e.row.add(t).draw()}),deletechild(d,d.parentElement)),alertMessage(n.message),t.removeAttribute("disabled"),t.innerHTML="proceed"}})},n.classList.add("loaded"),s.find("tbody").on("click",".delete-employee",function(){confirm("Are you sure you want to delete this employee?")&&e.row($(this).parents("tr")).remove().draw()})}else if("equipments-inventory"==x){let s=$(".datatables-equipments"),n=t.querySelector("table");n.classList.contains("loaded")||(e=s.DataTable({dom:'<"row mx-2"<"col-md-2"<"me-3"l>><"col-md-10"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-3 mb-md-0"fB>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search..."},columns:[{data:"",title:""},{data:"name",title:"Name"},{data:"quantity",title:"equipment's quantity"},{data:"unit",title:"measuring unit"},{title:"Action",data:"id"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(){return""}},{targets:1,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class="capitalize">${e}</span>`}},{targets:2,searchable:!1,orderable:1,render:function(e,t,a,s){return`<span class="">${adcm(e)}</span>`}},{targets:-1,searchable:!1,orderable:!1,render:function(e,t,a,s){return`<div class="d-inline-block text-nowrap">\n                                        <button class="btn btn-sm btn-icon data-buttns" data-type="equipments" data-role="edit" data-id="${e}" data-bs-target = "#edit-equipment"><i class="bx bx-edit"></i></button>\n                                        <button class="btn btn-sm btn-icon data-buttns" data-type="equipments" data-role="delete" data-id="${e}"><i class="bx bx-trash"></i></button>\n                                    </div>`}}],order:[[1,"asc"]],data:a.equipments,buttons:[{extend:"collection",className:"btn btn-outline-secondary dropdown-toggle mx-3",text:'<i class="bx bx-export me-1"></i>Export',buttons:[{extend:"print",text:'<i class="bx bx-printer me-2" ></i>Print',className:"dropdown-item"},{extend:"excel",text:'<i class="bx bxs-file-export me-2"></i>Excel',className:"dropdown-item"},{extend:"pdf",text:'<i class="bx bxs-file-pdf me-2"></i>Pdf',className:"dropdown-item"}]},{text:'<i class="bx bx-plus me-0 me-sm-1"></i><span class="d-none d-sm-inline-block">Add New</span>',className:"add-new btn btn-primary",attr:{id:"add-equipment","data-bs-target":"#add-equipment-modal"}}],initComplete:function(){this.api().columns(3).every(function(){var e=this,t=$('<select class="form-select text-capitalize"><option value=""> Select Measuring Unit </option></select>').appendTo(".employee-position").on("change",function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(e,a){t.append('<option value="'+e+'">'+e+"</option>")})})}}));let r=t.querySelector("#add-equipment"),i=Array.from(t.querySelectorAll("button.data-buttns"));i.forEach(s=>{s.onclick=async function(s){s.preventDefault();let n=this.getAttribute("data-role"),r=this.getAttribute("data-id"),i=this.getAttribute("data-type");if("delete"==n){postschema.body=JSON.stringify({token:getdata("token"),type:i,inventory:a.id,needle:r});var o=e.row(s.target.closest("tr"));o.remove().draw();let t=await request("rIFromInv",postschema);t.success,alertMessage(t.message)}else if("edit"==n){let e=a.equipments.find(function(e){return e.id==r}),s=this.getAttribute("data-bs-target"),n=t.querySelector(`div${s}`);n=n.cloneNode(!0),d=addshade(),d.appendChild(n);let o=n.querySelector("form#edit-equipment-form"),l=o.querySelector('input[name="equipment"]'),c=o.querySelector('input[name="quantity"]');l.value=e.name,l.setAttribute("readonly",!0),l.setAttribute("disabled",!0),l.setAttribute("data-id",e.id),c.value=e.quantity,o.addEventListener("submit",async e=>{if(e.preventDefault(),v=checkEmpty(c),v){let e=o.querySelector('button[type="submit"]');e.innerText="Editing entry",e.setAttribute("disabled",!0);let t={};Object.assign(t,{needle:l.getAttribute("data-id"),upinfo:{quantity:c.value},type:i,inventory:a.id}),Object.assign(t,{token:getdata("token")}),postschema.body=JSON.stringify(t);let s=await request("eInvEnt",postschema);s.success&&deletechild(d,d.parentNode),alertMessage(s.message),e.removeAttribute("disabled"),e.innerText="proceed"}})}}}),r.onclick=function(){let s=this.getAttribute("data-bs-target"),n=t.querySelector(`div${s}`);n=n.cloneNode(!0),d=addshade(),d.appendChild(n);let r=n.querySelector("form#add-equipment-form"),i=Array.from(r.querySelectorAll("input"));i[0].onfocus=(e=>{e.preventDefault(),showRecs(i[0],h.message,i[0].id)}),r.onsubmit=(async t=>{t.preventDefault(),l=1;for(const e of i)v=checkEmpty(e),v||(l=0);if(l){let t=r.querySelector('button[type="submit"]');t.innerHTML='<span class="spinner-border" role="status" aria-hidden="true"></span>',t.setAttribute("disabled",!0);let s={};for(const e of i)Object.assign(s,{[e.name]:getchips(e.parentNode.querySelector("div.chipsholder"),["id","name","quantity","unit"])});Object.assign(s,{assurance:this.assurance,token:getdata("token"),assurance:a.id}),postschema.body=JSON.stringify(s);let n=await request("add-inventory-equipments",postschema);n.success&&(s.equipments.forEach(t=>{e.row.add(t).draw()}),deletechild(d,d.parentElement)),alertMessage(n.message),t.removeAttribute("disabled"),t.innerHTML="proceed"}})},n.classList.add("loaded"),s.find("tbody").on("click",".delete-employee",function(){confirm("Are you sure you want to delete this employee?")&&e.row($(this).parents("tr")).remove().draw()})}else if("medical-prescriptions"==x){let n=t.querySelector("table");n.classList.contains("loaded")||addLoadingTab(t.querySelector("div.theb"));let r=t.querySelector("form#hp-form"),i=r.querySelector("input");function s(a){removeLoadingTab(t.querySelector("div.theb"));let s=$(".datatables-prescriptions");n.classList.contains("loaded")&&e.destroy(),e=s.DataTable({dom:'<"row mx-2"<"col-md-2"<"me-3"l>><"col-md-10"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-3 mb-md-0"fB>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search..."},columns:[{data:"",title:""},{data:"p_info.name",title:"patient"},{data:"in_info.name",title:"Insurance"},{data:"p_info.insurance.number",title:"insurance number"},{data:"payment_info.a_amount",title:"amount (RWF)"},{data:"payment_info.status",title:"status"},{data:"dateclosed",title:"date"},{title:"Action",data:"id"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(){return""}},{targets:1,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class="capitalize">${e}</span>`}},{targets:2,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class="">${e}</span>`}},{targets:3,searchable:1,orderable:!1,render:function(e,t,a,s){return`<span class="">${e}</span>`}},{targets:4,searchable:!1,orderable:1,render:function(e,t,a,s){return`<span class="">${adcm(e)}</span>`}},{targets:5,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class="btn btn-sm ${"pending"==e?"btn-label-secondary":"btn-label-success"}">${e}</span>`}},{targets:6,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class="">${e}</span>`}},{targets:-1,searchable:!1,orderable:!1,render:function(e,t,a,s){return`<div class="d-inline-block text-nowrap">\n                                            <button class="btn btn-sm btn-icon delete-equipment" data-id="${e}"><i class="bx bx-show"></i></button>\n                                        </div>`}}],order:[[1,"asc"]],data:a,buttons:[{extend:"collection",className:"btn btn-outline-secondary dropdown-toggle mx-3",text:'<i class="bx bx-export me-1"></i>Export',buttons:[{extend:"print",text:'<i class="bx bx-printer me-2" ></i>Print',className:"dropdown-item"},{extend:"excel",text:'<i class="bx bxs-file-export me-2"></i>Excel',className:"dropdown-item"},{extend:"pdf",text:'<i class="bx bxs-file-pdf me-2"></i>Pdf',className:"dropdown-item"}]}],initComplete:function(){n.classList.add("loaded"),this.api().columns(5).every(function(){var e=this,t=$('<select class="form-select text-capitalize"><option value=""> Select Status </option></select>').appendTo(".status").on("change",function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(e,a){t.append('<option value="'+e+'">'+e+"</option>")})})}})}i.onfocus=function(e){e.preventDefault(),showRecs(this,w.message,this.id)},r.onsubmit=async function(e){if(e.preventDefault(),!i.getAttribute("data-id"))return 0;let a=i.getAttribute("data-id");postschema.body=JSON.stringify({token:getdata("token"),assurance:a});let n=r.querySelector("button");n.innerHTML='<span class="spinner-border" role="status" aria-hidden="true"></span>',n.setAttribute("disabled",!0);let o=await request("get-hospital-medical-history",postschema);if(n.innerHTML='<i class="bx bx-search h-20p w-a center"></i>',n.removeAttribute("disabled"),!o.success)return alertMessage(o.message);t.querySelector(".status").querySelector("select")&&t.querySelector(".status").removeChild(t.querySelector(".status").querySelector("select")),s(o.message)},$.fn.dataTable.ext.search.push(function(e,t,a){if(e.nTable.classList.contains("datatables-prescriptions")){let e,a=u.value,s=m.value;return e=new Date(t[6]).toISOString().split("T")[0],""===a&&""===s||""===a&&e<=s||a<=e&&""===s||a<=e&&e<=s}return!0});let o,d=Array.from(t.querySelectorAll("button.view"));d.forEach(e=>{e.onclick=async function(t){t.preventDefault(),postschema.body=JSON.stringify({token:getdata("token"),type:"equipments",assurance:a.id,needle:this.getAttribute("data-id")});let s=await request("rAenrs",postschema);s.success?(alertMessage(s.message),deletechild(e.parentNode.parentNode.parentNode,e.parentNode.parentNode.parentNode.parentElement)):alertMessage(s.message)}});let l=t.querySelector('form[name="date-range"]'),c=Array.from(l.querySelectorAll("input")),u=c[0],m=c[1];l.onsubmit=function(t){t.preventDefault();let a={};e.draw(),o=e.rows({search:"applied"}).data().toArray();for(const e of c){if(!e.value)return 0;Object.assign(a,{[e.id]:new Date(e.value).toISOString().split("T")[0]})}};let p=t.querySelector(".act-button"),b=t.querySelector("#act-div");p.onclick=function(e){
e.preventDefault(),b.classList.toggle("hidden")};let f=Array.from(b.querySelectorAll(".act-buttons"));f.forEach(e=>{e.onclick=async function(t){if(b.classList.toggle("hidden"),t.preventDefault(),!o)return alertMessage("please filter data first"),0;let a=o.map(function(e){return e.payment_info.a_amount});if("calculate-total-price"==e.id){let e=0;a.map(function(t){return e+=t}),alertMessage(`the sum of the selected entries is <b>${adcm(e)} RWF</b>`)}else if("mark-as-paid"==e.id){let e=c[0].value,t=c[1].value;if(t){let a={min:e,max:t},s=i.getAttribute("data-id");postschema.body=JSON.stringify({token:getdata("token"),range:a,assurance:s});let n=await request("approve-assurance-payment",postschema);alertMessage(n.message)}}}})}}catch(e){console.log(e)}}z=userinfo;let o=getdata("token");if(o||(window.location.href="../../login/"),!z.success)return localStorage.removeItem("token"),alertMessage(z.message);if(z.success){z=z.message;try{const e=io(geturl(),{query:{id:z.id}});e.on("connect",()=>{console.log("Connected to the server")}),e.on("message",e=>{pushNotifs(e),addsCard(e.title,!0)}),e.on("expiratemssg",e=>{expirateMssg(e)}),e.on("selecthp",t=>{var a=document.createElement("div");document.body.appendChild(a);for(const e of t)a.innerHTML+=`<div id="${e.id}" class="verdana hover p-5p">${e.name}</div>`;let s=a.querySelectorAll("div");s.forEach(t=>{t.addEventListener("click",a=>{a.preventDefault(),e.emit("hpchoosen",{hp:t.id,token:localStorage.getItem("token")})})})}),e.on("changetoken",e=>{window.alert("token changed"),localStorage.setItem("token",e),window.location.href=window.location.href}),e.emit("messageToId",{recipientId:z.id,message:"wassup"}),"string"!=typeof z.hospital&&"object"==typeof z.hospital&&z.hospital.length>0&&e.emit("getpsforselection",z.hospital)}catch(e){console.log(e)}}postschema.body=JSON.stringify({token:o});const u=await request("hospital",postschema),m=await request("getmeds",postschema),b=await request("get-services",postschema),f=await request("get-tests",postschema),g=await request("get-operations",postschema),h=await request("get-equipments",postschema),y=await request("get-inventory",postschema),w=await request("gHosPiAsSu",postschema);if(!u.success)return alertMessage(u.message);if(!m.success)return alertMessage(m.message);if(!f.success)return alertMessage(f.message);if(!g.success)return alertMessage(g.message);if(!h.success)return alertMessage(h.message);if(!b.success)return alertMessage(b.message);if(!w.success)return alertMessage(w.message);if(!y.success)return alertMessage(y.message);let q=y.message;a=getPath(1),c=Array.from(document.querySelectorAll("span.cpcards")),p=Array.from(document.querySelectorAll("div.pagecontentsection")),a?p.forEach(e=>{if(a==e.id)return t=p.indexOf(e),c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),c[t].classList.add("active","bb-1-s-theme","bc-tr-theme","theme"),cpgcntn(t,p,q),s(e,q),0}):(window.history.pushState("","","./home"),cpgcntn(0,p,q)),window.onpopstate=function(){a=getPath(1),a?p.forEach(e=>{if(a==e.id)return t=p.indexOf(e),c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),c[t].classList.add("active","bb-1-s-theme","bc-tr-theme","theme"),cpgcntn(t,p),s(e,q),0}):(window.history.pushState("","","./home"),cpgcntn(0,p),s(p[0]))},c.forEach(e=>{e.addEventListener("click",()=>{c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),e.classList.add("active","bb-1-s-theme","bc-tr-theme","theme");let t=new URL(window.location.href);t.pathname=`/dof/${e.getAttribute("data-item-type")}`,window.history.pushState({},"",t.toString()),cpgcntn(c.indexOf(e),p,q);let a=p.find(function(t){return t.id==e.getAttribute("data-item-type")});a&&s(a,q)})})})();