function prepT(e,t,r){if("rankByHps"==t){let t,a,o=Object.keys(r).map(function(e){return r[e].total}),s=e.querySelector("#ranks-cont"),n=s.querySelector("li"),i=e.querySelector("#mainTotal");i.innerHTML=`${adcm(o.reduce((e,t)=>e+t))}`;for(const e of Object.keys(r)){a=r[e],t=n.cloneNode(!0);let o=t.querySelector("#name"),i=t.querySelector("#loc"),c=t.querySelector("#total");o.innerText=a.info.name,i.innerText=a.info.loc,c.innerText=adcm(a.total),s.appendChild(t)}deletechild(n,n.parentElement)}else if("rankByDiags"==t){let t,a,o=Object.keys(r).length,s=e.querySelector("#ranks-cont"),n=s.querySelector("li"),i=e.querySelector("#mainTotal");i.innerHTML=`${adcm(o)}`;for(const e of Object.keys(r)){a=r[e],t=n.cloneNode(!0);let o=t.querySelector("#name"),i=t.querySelector("#hosp"),c=t.querySelector("#hospcount"),l=t.querySelector("#total");o.innerText=e,i.innerText=a.mostAppearance.hospital,c.innerText=a.mostAppearance.count,l.innerText=adcm(r[e].total),s.appendChild(t)}deletechild(n,n.parentElement)}}function changeBtnBrdrClr(e){e.classList.toggle("b-1-s-theme");let t=Array.from(e.parentNode.querySelectorAll('[data-role="custom-buttns"]'));t.map(function(t){t!=e&&t.classList.remove("b-1-s-theme")})}function revolveStffs(e,t){let r=Array.from(t.querySelectorAll(".typesHol")),a=r.find(function(t){return t.getAttribute("data-id")==e.id});r.forEach(e=>{r.indexOf(e)>r.indexOf(a)?(e.classList.remove("active"),e.classList.remove("mt-60p","mt--60p","mt-0"),e.classList.add("mt-60p")):r.indexOf(e)<r.indexOf(a)&&(e.classList.remove("active"),e.classList.remove("mt-60p","mt--60p","mt-0"),e.classList.add("mt--60p"))}),a.classList.remove("mt-60p"),a.classList.remove("mt--60p"),a.classList.add("active"),a.classList.remove("mt-0")}function drawMainChart(r,a){let o,s,n,i,c,l;a?(i=Object.keys(r[Object.keys(r)[0]].total)[0],c=Object.keys(r[Object.keys(r)[0]].total)[1],o=Object.keys(r).map(function(e){return r[e].total[Object.keys(r[e].total)[0]]}),s=Object.keys(r).map(function(e){return r[e].total[Object.keys(r[e].total)[1]]}),n={series:[{name:i,data:o},{name:c,data:s}],chart:{height:300,stacked:!0,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,columnWidth:"33px",borderRadius:5}},colors:[config.colors.primary,config.colors.success],dataLabels:{enabled:!1},legend:{show:!0,horizontalAlign:"left",position:"top",markers:{height:8,width:8,radius:12,offsetX:-3},labels:{colors:e},itemMargin:{horizontal:10}},xaxis:{categories:Object.keys(r),labels:{style:{fontSize:"13px",colors:t}},axisTicks:{show:!1},axisBorder:{show:!1}},states:{hover:{filter:{type:"none"}},active:{filter:{type:"none"}}}}):(l=Object.keys(r).map(function(e){return r[e].total}),n={series:[{name:"Patients",data:l}],chart:{height:300,stacked:!0,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,columnWidth:"33px",borderRadius:5}},colors:[config.colors.primary],dataLabels:{enabled:!1},legend:{show:!0,horizontalAlign:"left",position:"top",markers:{height:8,width:8,radius:12,offsetX:-3},labels:{colors:e},itemMargin:{horizontal:10}},xaxis:{categories:Object.keys(r),labels:{style:{fontSize:"13px",colors:t}},axisTicks:{show:!1},axisBorder:{show:!1}},states:{hover:{filter:{type:"none"}},active:{filter:{type:"none"}}}});var d=document.querySelector("#mainChart");d.innerHTML=null,d=new ApexCharts(d,n),d.render()}function drawPatientsChart(e){let t,r=document.querySelector("div.patientsDiv"),a=r.querySelector(".pn-holder"),o=r.querySelector(".percentage"),n=Object.keys(e).map(function(t){return e[t].total}),i=e[Object.keys(e)[0]].total,c=e[Object.keys(e)[Object.keys(e).length-1]].total;t=(c-i)/i*100,i>c?(o.classList.add("text-danger"),o.innerHTML=`<span class="center">\n                <i class='bx bx-chevron-down'></i>\n            </span> <span class="center">${t}%</span></small>`):(o.classList.add("text-success"),o.innerHTML=`<span class="center">\n                <i class='bx bx-chevron-up'></i>\n            </span> <span class="center">${t}%</span></small>`),a.classList.remove("block"),a.classList.add("flex"),a.innerHTML=`<h3 class="mb-0 pn-holder">${adcm(n.reduce((e,t)=>e+t))}</h3><span class="dgray px-5p">Patients</span>`;let l={chart:{height:80,type:"area",toolbar:{show:!1},sparkline:{enabled:!0}},dataLabels:{enabled:!1},stroke:{width:2},legend:{show:!1},markers:{size:6,colors:"transparent",strokeColors:"transparent",strokeWidth:4,discrete:[{fillColor:config.colors.white,seriesIndex:0,dataPointIndex:7,strokeColor:config.colors.primary,strokeWidth:2,size:6,radius:8}],hover:{size:7}},grid:{show:!1,padding:{right:8}},colors:[config.colors.primary],fill:{type:"gradient",gradient:{shade:s,shadeIntensity:.8,opacityFrom:.8,opacityTo:.25,stops:[0,85,100]}},dataLabels:{enabled:!1},stroke:{width:2},series:[{name:"patients",data:n}],xaxis:{categories:Object.keys(e),show:!1,lines:{show:!1},labels:{show:!1},stroke:{width:0},axisBorder:{show:!1}},yaxis:{stroke:{width:0},show:!1}};var d=r.querySelector("#patientsChart");removeLoadingTab(d),d.innerHTML=null;d=new ApexCharts(d,l);d.render()}async function computeComp(e){let t,r,a,o=Array.from(e.querySelectorAll(".typesHol")),s=o.find(function(e){return e.classList.contains("active")});if(!s)return 0;t=Array.from(s.querySelectorAll("input"));for(const e of t){if(!e.value.trim())return 0;if(t[0].value>t[1].value)return 0}r=t[0].value,a=t[1].value,"year"==s.getAttribute("data-id")?(r=`${r}-01-01 00:00:00`,a=`${a}-12-31 00:00:00`):"month"==s.getAttribute("data-id")&&(r=`${r}-01 00:00:00`,a=`${a}-31 00:00:00`),"date"==s.getAttribute("data-id")&&(r=`${r} 00:00:00`,a=`${a} 00:00:00`);let n=DateTime.now();if(n=n.setZone("Africa/Kigali"),n=n.toString(),r>n)return 0;postschema.body=JSON.stringify({token:getdata("token"),range:{start:r,stop:a},compType:s.getAttribute("data-id")});const i=await request("insights",postschema);if(extra=i.message,!i.success)return alertMessage(i.message);comparison=s.getAttribute("data-id"),drawPatientsChart(extra.groupByDates),drawMainChart(extra.groupByHps,comparison)}import{postschema,request,alertMessage,getdata,getschema,animskel,deletechild,getPath,cpgcntn,sessiondata,calcTime,DateTime,geturl,adcm,removeLoadingTab,initializeSpecialCleave}from"../../../utils/functions.controller.js";let q,w,e,r,t,y,u,i,o,p,a,s,d,f,g,h,j,k,l,z,x,c,v,b,n,m,extra,comparison;import userinfo from"./nav.js";import{config}from"./config.js";(async function(){async function e(e){try{if(x=e.id,"my-account"==x){n=e.querySelector("span.name"),z=getdata("userinfo"),n.textContent=z.Full_name,i=e.querySelector("span.n-img"),i.textContent=z.Full_name.substring(0,1);let t=Array.from(e.querySelectorAll("span.icon-edit-icon"));for(const e of t)e.addEventListener("click",()=>{l=e.getAttribute("data-target"),shedtpopup(l,r)})}else if("home"==x){let r=Array.from(e.querySelectorAll('[data-role="custom-buttns"]')),a=Array.from(e.querySelectorAll("div.BttnsHol")),o=Array.from(e.querySelectorAll('div[data-role="shade"]')),s=[],n=e.querySelector("button#compareSearch"),{avaiGroupings:i}=extra;function t(t){t.forEach(t=>{t.onclick=function(r){r.preventDefault();let a,o=t.getAttribute("data-target");if("comparisonType"==o)a=e.querySelector(".typesHolCont"),revolveStffs(t,a);else if("groupBy"==o){let e=t.id;drawMainChart(extra[e],comparison)}changeBtnBrdrClr(this)}})}n.onclick=function(t){t.preventDefault(),computeComp(e)},a.forEach(a=>{if("groupByBttnsHol"==a.id){removeLoadingTab(a);for(const e of i){let t=document.createElement("button");t.setAttribute("data-target","groupBy"),t.setAttribute("type","button"),t.setAttribute("data-role","custom-buttns"),t.className="capitalize btn-label-primary btn btn-sm my-4p mx-2p",t.innerText=e,t.id="provinces"==e?"groupByProvinces":"districts"==e?"groupByDistricts":"sectors"==e?"groupBySectors":"cells"==e?"groupByCells":"health facilities"==e?"groupByHps":"",a.appendChild(t),"health facilities"==e&&t.classList.add("b-1-s-theme")}r=Array.from(e.querySelectorAll('[data-role="custom-buttns"]')),t(r)}}),o.forEach(e=>{s.push(e.parentNode),removeLoadingTab(e.parentNode)}),drawPatientsChart(extra.groupByDates),drawMainChart(extra.groupByHps);let c=extra.groupByResults,l=document.querySelector("div.resCard");for(const e of Object.keys(c)){let t=l.cloneNode(!0);t.querySelector(".name").innerText=e,t.querySelector(".total").innerText=adcm(c[e].total),l.parentNode.appendChild(t)}deletechild(l,l.parentElement);let d=Array.from(document.querySelectorAll("div.ranks"));d.forEach(e=>{prepT(e,e.id,extra[e.getAttribute("data-to-hold")])});let p=Array.from(e.querySelectorAll(".require-cleave"));p.forEach(e=>{let t=e.getAttribute("data-id");"year"==t&&initializeSpecialCleave(e,[4],4)})}}catch(e){console.log(e)}}z=userinfo;let o=getdata("token");if(o||(window.location.href="../../login/"),!z.success)return localStorage.removeItem("token"),alertMessage(z.message);if(z.success){z=z.message;try{const e=io(geturl(),{query:{id:z.id}});e.on("connect",()=>{console.log("Connected to the server")}),e.on("message",e=>{pushNotifs(e),addsCard(e.title,!0)}),e.on("expiratemssg",e=>{expirateMssg(e)}),e.emit("messageToId",{recipientId:z.id,message:"wassup"}),"string"!=typeof z.hospital&&"object"==typeof z.hospital&&z.hospital.length>0&&e.emit("getpsforselection",z.hospital)}catch(e){console.log(e)}}postschema.body=JSON.stringify({token:getdata("token"),range:{start:"",stop:""},groupBy:"hospitals"});const s=await request("insights",postschema);if(!s.success)return alertMessage(s.message);extra=s.message,a=getPath(1),c=Array.from(document.querySelectorAll("span.cpcards")),p=Array.from(document.querySelectorAll("div.pagecontentsection")),a?p.forEach(r=>{if(a==r.id)return t=p.indexOf(r),c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),c[t].classList.add("active","bb-1-s-theme","bc-tr-theme","theme"),cpgcntn(t,p,extra),e(r,extra),0}):(window.history.pushState("","","./home"),cpgcntn(0,p,extra)),window.onpopstate=function(){a=getPath(1),a?p.forEach(r=>{if(a==r.id)return t=p.indexOf(r),c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),c[t].classList.add("active","bb-1-s-theme","bc-tr-theme","theme"),cpgcntn(t,p),e(r,extra),0}):(window.history.pushState("","","./home"),cpgcntn(0,p),e(p[0]))},c.forEach(t=>{t.addEventListener("click",()=>{c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),t.classList.add("active","bb-1-s-theme","bc-tr-theme","theme");let r=new URL(window.location.href);r.pathname=`/mohs/${t.getAttribute("data-item-type")}`,window.history.pushState({},"",r.toString()),cpgcntn(c.indexOf(t),p,extra);let a=p.find(function(e){return e.id==t.getAttribute("data-item-type")});a&&e(a,extra)})})})();