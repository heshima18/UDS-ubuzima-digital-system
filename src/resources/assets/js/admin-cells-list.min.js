import{alertMessage,getdata,getschema,postschema,request,initializeCleave,checkEmpty,showRecs,getchips}from"../../../utils/functions.controller.js";let q,w,e,r,t,y,u,i,o,p,a,s,d,f,g,h,j,k,l,z,x,c,v,b,n,m;u=getdata("token"),u||(window.location.href="../../login"),async function(){m=await request("get-map",getschema),postschema.body=JSON.stringify({token:getdata("token")});try{m.success||alertMessage(m.message),m=m.message,l=[];for(let t of m){t=t.provinces[0];for(const e of t.districts)for(const a of e.sectors)for(const s of a.cells)l.push({province:t.name,name:s.name,district:e.name,sector:a.name,id:s.id})}f=document.querySelector("form#add-cell-form"),i=Array.from(f.querySelectorAll(".form-control")),b=f.querySelector('button[type="submit"]')}catch(t){console.log(t)}f.addEventListener("submit",async t=>{t.preventDefault(),v=1;for(const t of i)n=checkEmpty(t),n||(v=0);if(v){x={};for(const t of i)t.classList.contains("bevalue")?Object.assign(x,{[t.name]:t.getAttribute("data-id")}):Object.assign(x,{[t.name]:t.value});Object.assign(x,{token:getdata("token")}),postschema.body=JSON.stringify(x),b.setAttribute("disabled",!0),b.textContent="Recording sector info...",a=await request("add-cell",postschema),b.removeAttribute("disabled"),b.textContent="Submit",a.success?(alertMessage(a.message),f.reset()):alertMessage(a.message)}}),$(document).ready(function(){var t=$(".datatables-health-posts"),e=t.DataTable({dom:'<"row mx-2"<"col-md-2"<"me-3"l>><"col-md-10"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-3 mb-md-0"fB>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search..."},columns:[{data:""},{data:"name",title:"name"},{data:"province",title:"province"},{data:"district",title:"district"},{data:"sector",title:"sector"},{data:"",title:"Action"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(){return""}},{targets:1,searchable:1,orderable:1,render:function(t,e,a,s){return`<span class='d-block fw-semibold capitalize'>${t}</span>`}},{targets:2,searchable:1,orderable:1,render:function(t,e,a,s){return`<span class='d-block fw-semibold capitalize'>${t}</span>`}},{targets:-1,searchable:!1,orderable:!1,render:function(t,e,a,s){return`<div class="d-inline-block text-nowrap">\n                                    <button class="btn btn-sm btn-icon" data-bs-toggle="modal" data-bs-target="#view-health-post" data-id="${a.id}"><i class="bx bx-show-alt"></i></button>\n                                    <button class="btn btn-sm btn-icon" data-bs-toggle="modal" data-bs-target="#update-health-post" data-id="${a.id}"><i class="bx bx-edit"></i></button>\n                                    <button class="btn btn-sm btn-icon delete-health-post" data-id="${a.id}"><i class="bx bx-trash"></i></button>\n                                </div>`}}],order:[[1,"asc"]],data:l,buttons:[{extend:"collection",className:"btn btn-outline-secondary dropdown-toggle mx-3",text:'<i class="bx bx-export me-1"></i>Export',buttons:[{extend:"print",text:'<i class="bx bx-printer me-2" ></i>Print',className:"dropdown-item"},{extend:"excel",text:'<i class="bx bxs-file-export me-2"></i>Excel',className:"dropdown-item"},{extend:"pdf",text:'<i class="bx bxs-file-pdf me-2"></i>Pdf',className:"dropdown-item"}]},{text:'<i class="bx bx-plus me-0 me-sm-1"></i><span class="d-none d-sm-inline-block">Add New</span>',className:"add-new btn btn-primary",attr:{"data-bs-toggle":"modal","data-bs-target":"#add-cell"}}],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(t){return"Details of "+t.data().name}}),type:"column",renderer:function(t,e,a){return a=$.map(a,function(t,e){return""!==t.title?'<tr data-dt-row="'+t.rowIndex+'" data-dt-column="'+t.columnIndex+'"><td>'+t.title+":</td> <td>"+t.data+"</td></tr>":""}).join(""),!!a&&$('<table class="table"/><tbody />').append(a)}}},initComplete:function(){this.api().columns(2).every(function(){var t=this,e=$('<select class="form-select text-capitalize"><option value=""> Select District </option></select>').appendTo(".health-post-type").on("change",function(){var e=$.fn.dataTable.util.escapeRegex($(this).val());t.search(e?"^"+e+"$":"",!0,!1).draw()});t.data().unique().sort().each(function(t,a){e.append('<option value="'+t+'">'+t+"</option>")})})}});t.find("tbody").on("click",".delete-cell",function(){confirm("Are you sure you want to delete this cell?")&&e.row($(this).parents("tr")).remove().draw()}),$("#add-cell").on("shown.bs.modal",function(){$(this);z=[];for(let t of m){t=t.provinces[0];for(const e of t.districts)for(const t of e.sectors)z.push(t)}let t=f.querySelector("input#sector");t.addEventListener("focus",function(t){showRecs(this,z,"sector")})})})}();