import{alertMessage,getdata,getschema,postschema,request,initializeCleave,checkEmpty,showRecs,getchips,adcm}from"../../../utils/functions.controller.js";let q,w,e,r,t,y,u,i,o,p,a,s,d,f,g,h,j,k,l,z,x,c,v,b,n,m;u=getdata("token"),u||(window.location.href="../../login"),async function(){postschema.body=JSON.stringify({token:u}),m=await request("get-services",postschema);try{f=document.querySelector("form#add-service-form"),i=Array.from(f.querySelectorAll(".form-control")),b=f.querySelector('button[type="submit"]')}catch(e){console.log(e)}f.addEventListener("submit",async e=>{e.preventDefault(),v=1;for(const e of i)n=checkEmpty(e),n||(v=0);if(v){x={};for(const e of i)e.classList.contains("bevalue")?Object.assign(x,{[e.name]:e.getAttribute("data-id")}):Object.assign(x,{[e.name]:e.value});Object.assign(x,{token:getdata("token")}),postschema.body=JSON.stringify(x),b.setAttribute("disabled",!0),b.textContent="Recording service info...",a=await request("add-service",postschema),b.removeAttribute("disabled"),b.textContent="Submit",a.success?(alertMessage(a.message),f.reset()):alertMessage(a.message)}}),$(document).ready(function(){if(!m.success)return alertMessage(m.message);m=m.message;var e=$(".datatables-health-posts"),t=e.DataTable({dom:'<"row mx-2"<"col-md-2"<"me-3"l>><"col-md-10"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-3 mb-md-0"fB>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search..."},columns:[{data:""},{data:"name",title:"name"},{data:"price",title:"price"},{data:"unit",title:"unit"},{data:"",title:"Action"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(){return""}},{targets:1,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class='d-block fw-semibold capitalize'>${e}</span>`}},{targets:2,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class='d-block fw-semibold capitalize'>${adcm(e)}</span>`}},{targets:3,searchable:1,orderable:1,render:function(e,t,a,s){return`<span class='d-block fw-semibold capitalize'>${e}</span>`}},{targets:-1,searchable:!1,orderable:!1,render:function(e,t,a,s){return`<div class="d-inline-block text-nowrap">\n                                    <button class="btn btn-sm btn-icon" data-bs-toggle="modal" data-bs-target="#view-health-post" data-id="${a.id}"><i class="bx bx-show-alt"></i></button>\n                                    <button class="btn btn-sm btn-icon" data-bs-toggle="modal" data-bs-target="#update-health-post" data-id="${a.id}"><i class="bx bx-edit"></i></button>\n                                    <button class="btn btn-sm btn-icon delete-health-post" data-id="${a.id}"><i class="bx bx-trash"></i></button>\n                                </div>`}}],order:[[1,"asc"]],data:m,buttons:[{extend:"collection",className:"btn btn-outline-secondary dropdown-toggle mx-3",text:'<i class="bx bx-export me-1"></i>Export',buttons:[{extend:"print",text:'<i class="bx bx-printer me-2" ></i>Print',className:"dropdown-item"},{extend:"excel",text:'<i class="bx bxs-file-export me-2"></i>Excel',className:"dropdown-item"},{extend:"pdf",text:'<i class="bx bxs-file-pdf me-2"></i>Pdf',className:"dropdown-item"}]},{text:'<i class="bx bx-plus me-0 me-sm-1"></i><span class="d-none d-sm-inline-block">Add New</span>',className:"add-new btn btn-primary",attr:{"data-bs-toggle":"modal","data-bs-target":"#add-service"}}],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(e){return"Details of "+e.data().name}}),type:"column",renderer:function(e,t,a){return a=$.map(a,function(e,t){return""!==e.title?'<tr data-dt-row="'+e.rowIndex+'" data-dt-column="'+e.columnIndex+'"><td>'+e.title+":</td> <td>"+e.data+"</td></tr>":""}).join(""),!!a&&$('<table class="table"/><tbody />').append(a)}}},initComplete:function(){this.api().columns(3).every(function(){var e=this,t=$('<select class="form-select text-capitalize"><option value=""> Select Unit </option></select>').appendTo(".health-post-type").on("change",function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(e,a){t.append('<option value="'+e+'">'+e+"</option>")})})}});e.find("tbody").on("click",".delete-health-post",function(){confirm("Are you sure you want to delete this health post?")&&t.row($(this).parents("tr")).remove().draw()}),$("#add-service").on("shown.bs.modal",function(){$(this);let e=f.querySelector("input#unit");e.addEventListener("focus",function(e){showRecs(this,[{id:"days",name:"days"},{id:"hours",name:"hours"},{id:"kilometers",name:"kilometers"},{id:"meters",name:"meters"},{id:"night",name:"night"}],"unit")})})})}();