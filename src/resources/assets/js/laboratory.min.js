async function gsd(e,a){try{if(x=e.id,"search-patient"==x)f=e.querySelector('form[name="sp-form"]'),s=f.querySelector('input[type="text"]'),setTimeout(e=>{s.focus()},200),b=f.querySelector('button[type="submit"]'),f.addEventListener("submit",async e=>(e.preventDefault(),s.value?(b.innerHTML='<span class="spinner-border" role="status" aria-hidden="true"></span>',b.setAttribute("disabled",!0),r=await request(`patient/${s.value}`,postschema),b.innerHTML='<i class="bx bx-search h-20p w-a center"></i>',b.removeAttribute("disabled"),r.success?void addUprofile(r.message):alertMessage(r.message)):0));else if("my-account"==x){n=e.querySelector("span.name"),z=getdata("userinfo"),n.textContent=z.Full_name,i=e.querySelector("span.n-img"),i.textContent=z.Full_name.substring(0,1);let t=Array.from(e.querySelectorAll("span.icon-edit-icon"));for(const e of t)e.addEventListener("click",()=>{l=e.getAttribute("data-target"),shedtpopup(l,r)})}else if("record-tests"==x)try{f=document.querySelector("form#record-test-form"),i=Array.from(f.querySelectorAll(".form-control"));let e=Array.from(f.querySelectorAll("input.extras"));f.querySelector('input[name="operations"]');if(e.map(function(e){e.addEventListener("focus",t=>{showRecs(e,a[e.id],e.id)})}),n=i.find(function(e){return"patient"==e.id}),s=i.find(function(e){return"session"==e.id}),t=i.find(function(e){return"test"==e.id}),a){let e;a.addins?e=a.addins:a.extra&&(e=a.extra),n.value=e.patient_name,n.setAttribute("data-id",e.patient),s.value=`${e.patient_name}'s session`,s.setAttribute("data-id",e.session),n.setAttribute("disabled",!0),s.setAttribute("disabled",!0),t.setAttribute("disabled",!0),t.value=`${e.t_name}`,t.setAttribute("data-id",e.test)}let o=f.querySelector('button[type="submit"]');f.onsubmit=(async e=>{let t,s,n,r,c;n="",r="",s={},v=1,e.preventDefault();for(const e of i)t=checkEmpty(e),t||(v=0),e.classList.contains("chips-check")?Object.assign(s,{[e.name]:getchips(e.parentNode.querySelector("div.chipsholder"))}):e.classList.contains("bevalue")?Object.assign(s,{[e.name]:e.getAttribute("data-id")}):Object.assign(s,{[e.name]:e.value});if(v&&(Object.assign(s,{test:{id:s.test,result:s.result,sample:s.sample}}),delete s.sample,delete s.result,Object.assign(s,{token:getdata("token")}),postschema.body=JSON.stringify(s),o.setAttribute("disabled",!0),o.textContent="recording session test info...",c=await request("add-session-test",postschema),o.removeAttribute("disabled",!0),o.textContent="submit test",alertMessage(c.message),c.success)){f.reset(),j={},Object.assign(j,{token:getdata("token"),title:"incoming test results",token:getdata("token"),receiver:a.sender.id,type:"test_res_message",content:`the results of ${session.t_name} for  ${session.patient_name} are ready to view`,extra:{test:session.test,t_name:session.t_name,session:session.session,patient:session.patient},controller:{looping:!1,recipients:[]}}),sessionStorage.removeItem("pinfo");try{if(postschema.body=JSON.stringify(j),c=await request("send-message",postschema),!c.success)return alertMessage(c.message);addsCard("session owner notified !",!0)}catch(e){console.log(e)}}})}catch(e){console.log(e)}}catch(e){console.log(e)}}import{alertMessage,getdata,getschema,postschema,request,initializeCleave,sessiondata,checkEmpty,showRecs,getchips,getPath,addsCard,cpgcntn,geturl}from"../../../utils/functions.controller.js";import{expirateMssg,getNfPanelLinks,pushNotifs,userinfo,m as messages}from"./nav.js";let q,w,e,r,t,y,u,i,o,p,a,s,d,f,g,h,j,k,l,x,c,v,b,n,m,z,notificationlinks;(async function(){function e(e){let t=sessiondata("messages");e.map(e=>{e.addEventListener("click",()=>{if(!e.classList.contains("list-link"))return 0;v=document.querySelector(`div#${e.getAttribute("data-href-target")}`);let a=t.find(function(t){return t.id==e.getAttribute("data-id")});if(v&&a){p=Array.from(v.parentElement.querySelectorAll(".pagecontentsection")),s=p.indexOf(v);let t,n=new URL(window.location.href);"req_test_message"==e.getAttribute("data-message-type")||"session_message"==e.getAttribute("data-message-type")?(a.addins?t=a.addins:a.extra&&(t=a.extra),t&&(n.pathname=`/${getPath()[0]}/${e.getAttribute("data-href-target")}`)):n.pathname=`/${getPath()[0]}/${e.getAttribute("data-href-target")}`,window.history.pushState({},"",n.toString()),cpgcntn(p.indexOf(v),p),gsd(v,a)}})})}z=userinfo;let n=getdata("token");if(n||(window.location.href="../../login/"),!z.success)return localStorage.removeItem("token"),alertMessage(z.message);if(z.success){z=z.message;try{const t=io(geturl(),{query:{id:z.id}});t.on("connect",()=>{console.log("Connected to the server")}),t.on("message",t=>{pushNotifs(t),messages.push(t),notificationlinks=getNfPanelLinks(),e(notificationlinks),addsCard(t.title,!0)}),t.on("expiratemssg",e=>{expirateMssg(e)}),t.on("selecthp",e=>{var s=document.createElement("div");document.body.appendChild(s);for(const t of e)s.innerHTML+=`<div id="${t.id}" class="verdana hover p-5p">${t.name}</div>`;let a=s.querySelectorAll("div");a.forEach(e=>{e.addEventListener("click",s=>{s.preventDefault(),t.emit("hpchoosen",{hp:e.id,token:localStorage.getItem("token")})})})}),t.on("changetoken",e=>{window.alert("token changed"),localStorage.setItem("token",e),window.location.href=window.location.href}),t.emit("messageToId",{recipientId:z.id,message:"wassup"}),"string"!=typeof z.hospital&&"object"==typeof z.hospital&&z.hospital.length>0&&t.emit("getpsforselection",z.hospital)}catch(e){console.log(e)}}postschema.body=JSON.stringify({token:n});let i=await request("get-hp-employees",postschema);if(f=await request("get-tests",postschema),!f.success)return alertMessage(f.message);let o={users:i.message,tests:f.message};a=getPath(1),c=Array.from(document.querySelectorAll("span.cpcards")),p=Array.from(document.querySelectorAll("div.pagecontentsection")),a?p.forEach(e=>{if(a==e.id)return t=p.indexOf(e),c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),c[t].classList.add("active","bb-1-s-theme","bc-tr-theme","theme"),cpgcntn(t,p,o),gsd(e),0}):(window.history.pushState("","","./home"),cpgcntn(0,p,o)),window.onpopstate=function(){a=getPath(1),a?p.forEach(e=>{if(a==e.id)return t=p.indexOf(e),c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),c[t].classList.add("active","bb-1-s-theme","bc-tr-theme","theme"),cpgcntn(t,p),gsd(e),0}):(window.history.pushState("","","./home"),cpgcntn(0,p),gsd(p[0]))},c.forEach(e=>{e.addEventListener("click",()=>{c.forEach(e=>{e.classList.remove("active","bb-1-s-theme","bc-tr-theme","theme")}),e.classList.add("active","bb-1-s-theme","bc-tr-theme","theme");let t=new URL(window.location.href);t.pathname=`/laboratory_scientist/${e.getAttribute("data-item-type")}`,window.history.pushState({},"",t.toString()),cpgcntn(c.indexOf(e),p,o),gsd(p[c.indexOf(e)])})}),notificationlinks=getNfPanelLinks(),e(notificationlinks)})();